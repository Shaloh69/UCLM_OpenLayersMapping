{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/typeSafeGeometryUtils.ts"],"sourcesContent":["import { Geometry } from \"ol/geom\";\r\nimport LineString from \"ol/geom/LineString\";\r\nimport Point from \"ol/geom/Point\";\r\nimport { Feature } from \"ol\";\r\n\r\n/**\r\n * Type-safe utility to get coordinates from any geometry\r\n *\r\n * @param geometry The geometry to extract coordinates from\r\n * @returns A safe array of coordinates or null if not available\r\n */\r\nexport const getSafeCoordinates = (\r\n  geometry: Geometry | null | undefined\r\n): number[] | null => {\r\n  if (!geometry) return null;\r\n\r\n  try {\r\n    if (geometry instanceof Point) {\r\n      return geometry.getCoordinates();\r\n    }\r\n\r\n    if (geometry instanceof LineString) {\r\n      const firstCoord = geometry.getFirstCoordinate();\r\n      return firstCoord || null;\r\n    }\r\n\r\n    // Fallback for other geometry types\r\n    if (typeof (geometry as any).getFirstCoordinate === \"function\") {\r\n      return (geometry as any).getFirstCoordinate();\r\n    }\r\n\r\n    if (typeof (geometry as any).getCoordinates === \"function\") {\r\n      const coords = (geometry as any).getCoordinates();\r\n      if (Array.isArray(coords) && coords.length > 0) {\r\n        if (Array.isArray(coords[0])) {\r\n          return coords[0];\r\n        }\r\n        return coords;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error getting coordinates from geometry:\", error);\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/**\r\n * Type-safe utility to get length from a geometry\r\n *\r\n * @param geometry The geometry to measure\r\n * @returns The length of the geometry or 0 if not available\r\n */\r\nexport const getSafeLength = (\r\n  geometry: Geometry | null | undefined\r\n): number => {\r\n  if (!geometry) return 0;\r\n\r\n  try {\r\n    if (geometry instanceof LineString) {\r\n      return geometry.getLength();\r\n    }\r\n\r\n    // Fallback for other geometry types\r\n    if (typeof (geometry as any).getLength === \"function\") {\r\n      return (geometry as any).getLength();\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error calculating geometry length:\", error);\r\n  }\r\n\r\n  return 0;\r\n};\r\n\r\n/**\r\n * Type-safe utility to get the type of a geometry\r\n *\r\n * @param geometry The geometry to check\r\n * @returns The geometry type as a string\r\n */\r\nexport const getSafeGeometryType = (\r\n  geometry: Geometry | null | undefined\r\n): string => {\r\n  if (!geometry) return \"unknown\";\r\n\r\n  try {\r\n    return geometry.getType();\r\n  } catch (error) {\r\n    console.error(\"Error getting geometry type:\", error);\r\n    return \"unknown\";\r\n  }\r\n};\r\n\r\n/**\r\n * Type-safe utility to calculate total path length from features\r\n *\r\n * @param features Array of features to measure\r\n * @returns Total length of all features\r\n */\r\nexport const calculatePathLength = (features: Feature[]): number => {\r\n  let totalLength = 0;\r\n\r\n  features.forEach((feature) => {\r\n    const geometry = feature.getGeometry();\r\n    totalLength += getSafeLength(geometry);\r\n  });\r\n\r\n  return totalLength;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAEA;AADA;;;AAUO,MAAM,qBAAqB,CAChC;IAEA,IAAI,CAAC,UAAU,OAAO;IAEtB,IAAI;QACF,IAAI,oBAAoB,sIAAA,CAAA,UAAK,EAAE;YAC7B,OAAO,SAAS,cAAc;QAChC;QAEA,IAAI,oBAAoB,2IAAA,CAAA,UAAU,EAAE;YAClC,MAAM,aAAa,SAAS,kBAAkB;YAC9C,OAAO,cAAc;QACvB;QAEA,oCAAoC;QACpC,IAAI,OAAO,AAAC,SAAiB,kBAAkB,KAAK,YAAY;YAC9D,OAAO,AAAC,SAAiB,kBAAkB;QAC7C;QAEA,IAAI,OAAO,AAAC,SAAiB,cAAc,KAAK,YAAY;YAC1D,MAAM,SAAS,AAAC,SAAiB,cAAc;YAC/C,IAAI,MAAM,OAAO,CAAC,WAAW,OAAO,MAAM,GAAG,GAAG;gBAC9C,IAAI,MAAM,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG;oBAC5B,OAAO,MAAM,CAAC,EAAE;gBAClB;gBACA,OAAO;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4CAA4C;IAC5D;IAEA,OAAO;AACT;AAQO,MAAM,gBAAgB,CAC3B;IAEA,IAAI,CAAC,UAAU,OAAO;IAEtB,IAAI;QACF,IAAI,oBAAoB,2IAAA,CAAA,UAAU,EAAE;YAClC,OAAO,SAAS,SAAS;QAC3B;QAEA,oCAAoC;QACpC,IAAI,OAAO,AAAC,SAAiB,SAAS,KAAK,YAAY;YACrD,OAAO,AAAC,SAAiB,SAAS;QACpC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;IACtD;IAEA,OAAO;AACT;AAQO,MAAM,sBAAsB,CACjC;IAEA,IAAI,CAAC,UAAU,OAAO;IAEtB,IAAI;QACF,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACT;AACF;AAQO,MAAM,sBAAsB,CAAC;IAClC,IAAI,cAAc;IAElB,SAAS,OAAO,CAAC,CAAC;QAChB,MAAM,WAAW,QAAQ,WAAW;QACpC,eAAe,cAAc;IAC/B;IAEA,OAAO;AACT"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/routeProcessor.ts"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport GeoJSON from \"ol/format/GeoJSON\";\r\nimport { Feature } from \"ol\";\r\nimport { Geometry } from \"ol/geom\";\r\nimport Map from \"ol/Map\";\r\nimport { toLonLat } from \"ol/proj\";\r\nimport { RoadNode } from \"./roadSystem\";\r\nimport { RouteData } from \"./qrCodeUtils\";\r\nimport { getSafeCoordinates } from \"./typeSafeGeometryUtils\";\r\n\r\n/**\r\n * Custom hook for processing route data from URLs or passed props\r\n */\r\nexport const useRouteProcessor = (\r\n  nodesUrl: string,\r\n  roadsUrl: string,\r\n  mapInstanceRef: React.MutableRefObject<Map | null>,\r\n  displayRoute: (startNodeId: string, endNodeId: string) => void,\r\n  setCurrentLocation: React.Dispatch<React.SetStateAction<RoadNode | null>>,\r\n  setSelectedDestination: React.Dispatch<React.SetStateAction<RoadNode | null>>,\r\n  setRouteInfo: React.Dispatch<\r\n    React.SetStateAction<\r\n      { distance: number; estimatedTime: number } | undefined\r\n    >\r\n  >,\r\n  setShowRouteOverlay: React.Dispatch<React.SetStateAction<boolean>>,\r\n  routeData: RouteData | null | undefined,\r\n) => {\r\n  // Store loaded features in a ref to avoid unnecessary re-renders\r\n  const allFeaturesRef = useRef<Feature<Geometry>[]>([]);\r\n  const [featuresReady, setFeaturesReady] = useState(false);\r\n  const routeProcessedRef = useRef(false);\r\n\r\n  // Helper function to create a RoadNode from a feature\r\n  const createNodeFromFeature = useCallback(\r\n    (feature: Feature | any): RoadNode => {\r\n      const geometry = feature.getGeometry();\r\n      const coords = getSafeCoordinates(geometry);\r\n\r\n      // Ensure it's a tuple [number, number] for RoadNode\r\n      const geoCoords =\r\n        coords && coords.length >= 2\r\n          ? (toLonLat(coords) as [number, number])\r\n          : ([0, 0] as [number, number]);\r\n\r\n      return {\r\n        id:\r\n          feature.get(\"id\") ||\r\n          `node-${Math.random().toString(36).substring(2, 9)}`,\r\n        name: feature.get(\"name\") || \"Location\",\r\n        isDestination: !!feature.get(\"isDestination\"),\r\n        coordinates: geoCoords,\r\n        category: feature.get(\"category\"),\r\n        description: feature.get(\"description\"),\r\n        imageUrl: feature.get(\"imageUrl\"),\r\n      };\r\n    },\r\n    []\r\n  );\r\n\r\n  // Load features directly from GeoJSON files\r\n  useEffect(() => {\r\n    // Skip if features are already loaded\r\n\r\n    if (featuresReady || allFeaturesRef.current.length > 0) return;\r\n\r\n    // Use actual URLs, not placeholder paths\r\n    const actualNodesUrl = nodesUrl.startsWith(\"...\")\r\n      ? \"/UCLM_Nodes.geojson\"\r\n      : nodesUrl;\r\n    const actualRoadsUrl = roadsUrl.startsWith(\"...\")\r\n      ? \"/UCLM_Roads.geojson\"\r\n      : roadsUrl;\r\n\r\n    // Create a GeoJSON format instance\r\n    const format = new GeoJSON({\r\n      dataProjection: \"EPSG:4326\",\r\n      featureProjection: \"EPSG:3857\",\r\n    });\r\n\r\n    // Fetch both files in parallel\r\n    Promise.all([\r\n      fetch(actualNodesUrl).then((res) => res.json()),\r\n      fetch(actualRoadsUrl).then((res) => res.json()),\r\n    ])\r\n      .then(([nodesJson, roadsJson]) => {\r\n        try {\r\n          // Parse the JSON into features\r\n          const nodeFeatures = format.readFeatures(nodesJson);\r\n          const roadFeatures = format.readFeatures(roadsJson);\r\n\r\n          // Store in ref\r\n          allFeaturesRef.current = [...nodeFeatures, ...roadFeatures];\r\n\r\n          // Mark features as ready\r\n          setFeaturesReady(true);\r\n        } catch (error) {\r\n          console.error(\"Error parsing GeoJSON:\", error);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"❌ Failed to load GeoJSON files:\", error);\r\n      });\r\n  }, [nodesUrl, roadsUrl, featuresReady]);\r\n\r\n  // Process route data once features are loaded\r\n  useEffect(() => {\r\n    // Skip if no route data, features not ready, map not ready, or already processed\r\n    if (\r\n      !routeData ||\r\n      !featuresReady ||\r\n      !mapInstanceRef.current ||\r\n      routeProcessedRef.current\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const { startNodeId, endNodeId } = routeData;\r\n    const features = allFeaturesRef.current;\r\n\r\n\r\n    // First try exact match\r\n    let startFeature = features.find((f) => f.get(\"id\") === startNodeId);\r\n    let endFeature = features.find((f) => f.get(\"id\") === endNodeId);\r\n\r\n    // If not found, try case-insensitive match\r\n    if (!startFeature) {\r\n      startFeature = features.find(\r\n        (f) => f.get(\"id\")?.toLowerCase() === startNodeId?.toLowerCase()\r\n      );\r\n    }\r\n\r\n    if (!endFeature) {\r\n      endFeature = features.find(\r\n        (f) => f.get(\"id\")?.toLowerCase() === endNodeId?.toLowerCase()\r\n      );\r\n    }\r\n\r\n    if (!startFeature || !endFeature) {\r\n      console.error(\"❌ Could not find start or end feature:\", {\r\n        startNodeId,\r\n        endNodeId,\r\n        availableIds: features\r\n          .filter((f) => f.get(\"id\"))\r\n          .map((f) => f.get(\"id\"))\r\n          .slice(0, 10), // Just show the first 10 to avoid log flooding\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Create node objects from features\r\n    const startNode = createNodeFromFeature(startFeature);\r\n    const endNode = createNodeFromFeature(endFeature);\r\n\r\n\r\n    // Update state\r\n    setCurrentLocation(startNode);\r\n    setSelectedDestination(endNode);\r\n\r\n    // Display the route\r\n    displayRoute(startNode.id, endNode.id);\r\n\r\n    // Set route info if available\r\n    if (routeData.routeInfo) {\r\n      setRouteInfo(routeData.routeInfo);\r\n    }\r\n\r\n    // Show the route overlay\r\n    setShowRouteOverlay(true);\r\n\r\n    // Mark as processed to avoid duplicate processing\r\n    routeProcessedRef.current = true;\r\n\r\n  }, [\r\n    routeData,\r\n    featuresReady,\r\n    mapInstanceRef,\r\n    displayRoute,\r\n    setCurrentLocation,\r\n    setSelectedDestination,\r\n    setRouteInfo,\r\n    setShowRouteOverlay,\r\n    createNodeFromFeature,\r\n  ]);\r\n\r\n  // Method to reset the route processing state - useful for clearing routes\r\n  const resetRouteProcessor = useCallback(() => {\r\n    routeProcessedRef.current = false;\r\n  }, []);\r\n\r\n  // Return any values needed from this hook\r\n  return {\r\n    featuresReady,\r\n    allFeatures: allFeaturesRef.current,\r\n    resetRouteProcessor,\r\n  };\r\n};\r\n\r\nexport default useRouteProcessor;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 261, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/layers.ts"],"sourcesContent":["import Map from \"ol/Map\";\r\nimport View from \"ol/View\";\r\nimport VectorLayer from \"ol/layer/Vector\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport GeoJSON from \"ol/format/GeoJSON\";\r\nimport { fromLonLat } from \"ol/proj\";\r\nimport { Fill, Stroke, Style } from \"ol/style\";\r\nimport { Feature } from \"ol\";\r\nimport { Polygon } from \"ol/geom\";\r\nimport { defaults as defaultControls } from \"ol/control\";\r\nimport Rotate from \"ol/control/Rotate\";\r\nimport CircleStyle from \"ol/style/Circle\";\r\nimport { Extent, createEmpty, extend, buffer } from \"ol/extent\";\r\n\r\n// Helper function to create a random color\r\nexport const getRandomColor = () => {\r\n  const letters = \"0123456789ABCDEF\";\r\n  let color = \"#\";\r\n  for (let i = 0; i < 6; i++) {\r\n    color += letters[Math.floor(Math.random() * 16)];\r\n  }\r\n  return color;\r\n};\r\n\r\nexport const hexToRGBA = (hex: string, opacity: number = 0.5) => {\r\n  hex = hex.replace(/^#/, \"\");\r\n  const r = parseInt(hex.substring(0, 2), 16);\r\n  const g = parseInt(hex.substring(2, 4), 16);\r\n  const b = parseInt(hex.substring(4, 6), 16);\r\n  return `rgba(${r}, ${g}, ${b}, ${opacity})`;\r\n};\r\n\r\nexport const setupLayers = (\r\n  mapElement: HTMLElement,\r\n  backdropColor: string,\r\n  centerCoordinates: [number, number],\r\n  initialZoom: number,\r\n  mapUrl: string,\r\n  pointsUrl: string\r\n) => {\r\n  const backdropLayer = new VectorLayer({\r\n    source: new VectorSource({\r\n      features: [\r\n        new Feature(\r\n          new Polygon([\r\n            [\r\n              [-20037508.34, -20037508.34],\r\n              [-20037508.34, 20037508.34],\r\n              [20037508.34, 20037508.34],\r\n              [20037508.34, -20037508.34],\r\n              [-20037508.34, -20037508.34],\r\n            ],\r\n          ])\r\n        ),\r\n      ],\r\n    }),\r\n    style: new Style({\r\n      fill: new Fill({\r\n        color: backdropColor,\r\n      }),\r\n    }),\r\n  });\r\n\r\n  const pointsSource = new VectorSource({\r\n    url: pointsUrl,\r\n    format: new GeoJSON({\r\n      dataProjection: \"EPSG:4326\",\r\n      featureProjection: \"EPSG:3857\",\r\n    }),\r\n  });\r\n\r\n  const pointsLayer = new VectorLayer({\r\n    source: pointsSource,\r\n    style: (feature) => {\r\n      const properties = feature.getProperties();\r\n      const color = properties[\"marker-color\"] || \"#ff0000\";\r\n      const size =\r\n        properties[\"marker-size\"] === \"large\"\r\n          ? 10\r\n          : properties[\"marker-size\"] === \"medium\"\r\n            ? 6\r\n            : 4;\r\n\r\n      return new Style({\r\n        image: new CircleStyle({\r\n          radius: size,\r\n          fill: new Fill({ color }),\r\n          stroke: new Stroke({ color: \"black\", width: 1 }),\r\n        }),\r\n      });\r\n    },\r\n  });\r\n\r\n  const vectorSource = new VectorSource({\r\n    url: mapUrl,\r\n    format: new GeoJSON({\r\n      dataProjection: \"EPSG:4326\",\r\n      featureProjection: \"EPSG:3857\",\r\n    }),\r\n  });\r\n\r\n  const vectorLayer = new VectorLayer({\r\n    source: vectorSource,\r\n    style: (feature) => {\r\n      try {\r\n        const properties = feature.getProperties();\r\n        const fillColor = properties.fill || properties.fillColor || \"#0080ff\";\r\n        const strokeColor =\r\n          properties.stroke || properties.strokeColor || \"black\";\r\n        const fillOpacity = properties[\"fill-opacity\"] ?? 0.5;\r\n\r\n        return new Style({\r\n          fill: new Fill({\r\n            color: hexToRGBA(fillColor, fillOpacity),\r\n          }),\r\n          stroke: new Stroke({\r\n            color: strokeColor,\r\n            width: properties.strokeWidth || 3,\r\n          }),\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Style creation error:\", error);\r\n        return new Style();\r\n      }\r\n    },\r\n  });\r\n\r\n  const view = new View({\r\n    center: fromLonLat(centerCoordinates),\r\n    zoom: initialZoom,\r\n    minZoom: 16,\r\n    maxZoom: 21,\r\n    enableRotation: true,\r\n    rotation: 44.86,\r\n    constrainResolution: true,\r\n    smoothResolutionConstraint: true,\r\n  });\r\n\r\n  const map = new Map({\r\n    target: mapElement,\r\n    layers: [backdropLayer, vectorLayer, pointsLayer],\r\n    view,\r\n    controls: defaultControls({\r\n      zoom: true,\r\n      rotate: true,\r\n      attribution: false,\r\n    }).extend([new Rotate()]),\r\n  });\r\n\r\n  // Calculate extent from all sources and constrain map bounds\r\n  let combinedExtent: Extent | null = null;\r\n  let isAdjustingCenter = false;\r\n\r\n  const updateMapExtent = () => {\r\n    const extent = createEmpty();\r\n    let hasFeatures = false;\r\n\r\n    const vectorFeatures = vectorSource.getFeatures();\r\n    if (vectorFeatures.length > 0) {\r\n      vectorFeatures.forEach((feature) => {\r\n        const geom = feature.getGeometry();\r\n        if (geom) {\r\n          extend(extent, geom.getExtent());\r\n          hasFeatures = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    const pointFeatures = pointsSource.getFeatures();\r\n    if (pointFeatures.length > 0) {\r\n      pointFeatures.forEach((feature) => {\r\n        const geom = feature.getGeometry();\r\n        if (geom) {\r\n          extend(extent, geom.getExtent());\r\n          hasFeatures = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (hasFeatures) {\r\n      combinedExtent = buffer(extent,\r\n        Math.max(\r\n          extent[2] - extent[0],\r\n          extent[3] - extent[1]\r\n        ) * 0.2\r\n      );\r\n\r\n      view.fit(combinedExtent, {\r\n        padding: [50, 50, 50, 50],\r\n        maxZoom: 19,\r\n        duration: 1000,\r\n      });\r\n    }\r\n  };\r\n\r\n  vectorSource.once(\"featuresloadend\", updateMapExtent);\r\n  pointsSource.once(\"featuresloadend\", updateMapExtent);\r\n\r\n  view.on(\"change:center\", () => {\r\n    if (!combinedExtent || isAdjustingCenter) return;\r\n\r\n    const currentCenter = view.getCenter();\r\n    if (!currentCenter) return;\r\n\r\n    const currentExtent = view.calculateExtent();\r\n    const [minX, minY, maxX, maxY] = combinedExtent;\r\n    const [viewMinX, viewMinY, viewMaxX, viewMaxY] = currentExtent;\r\n\r\n    let newCenter = [...currentCenter];\r\n    let needsAdjustment = false;\r\n\r\n    if (viewMinX < minX) {\r\n      newCenter[0] += (minX - viewMinX);\r\n      needsAdjustment = true;\r\n    } else if (viewMaxX > maxX) {\r\n      newCenter[0] -= (viewMaxX - maxX);\r\n      needsAdjustment = true;\r\n    }\r\n\r\n    if (viewMinY < minY) {\r\n      newCenter[1] += (minY - viewMinY);\r\n      needsAdjustment = true;\r\n    } else if (viewMaxY > maxY) {\r\n      newCenter[1] -= (viewMaxY - maxY);\r\n      needsAdjustment = true;\r\n    }\r\n\r\n    if (needsAdjustment) {\r\n      isAdjustingCenter = true;\r\n      view.setCenter(newCenter as [number, number]);\r\n      setTimeout(() => { isAdjustingCenter = false; }, 10);\r\n    }\r\n  });\r\n\r\n  return {\r\n    map,\r\n    vectorSource,\r\n    pointsSource,\r\n    view,\r\n    getExtent: () => combinedExtent,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 521, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 527, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/locationTracking.ts"],"sourcesContent":["import { Fill, Stroke, Style } from \"ol/style\";\r\nimport Feature from \"ol/Feature\";\r\nimport Point from \"ol/geom/Point\";\r\nimport { fromLonLat } from \"ol/proj\";\r\nimport { Circle as CircleGeometry } from \"ol/geom\";\r\nimport VectorLayer from \"ol/layer/Vector\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport CircleStyle from \"ol/style/Circle\";\r\nimport { Extent } from \"ol/extent\";\r\nimport { containsCoordinate } from \"ol/extent\";\r\nimport Map from \"ol/Map\";\r\nimport { MutableRefObject } from \"react\";\r\n\r\n// Check if coordinates are within school boundary\r\nexport const isCoordinateInsideSchool = (\r\n  coords: number[],\r\n  boundary: Extent | null\r\n) => {\r\n  if (!boundary) return true; // If no boundary defined, assume inside\r\n  return containsCoordinate(boundary, coords);\r\n};\r\n\r\nexport const setupLocationTracking = (\r\n  map: Map,\r\n  locationErrorRef: MutableRefObject<string | null>,\r\n  isOutsideSchoolRef: MutableRefObject<boolean>,\r\n  schoolBoundaryRef: MutableRefObject<Extent | null>,\r\n  isUpdatingPositionRef: MutableRefObject<boolean>\r\n) => {\r\n  // GPS Marker & Accuracy Circle\r\n  const userPositionFeature = new Feature({\r\n    geometry: new Point(fromLonLat([0, 0])),\r\n  });\r\n\r\n  const accuracyFeature = new Feature({\r\n    geometry: new CircleGeometry(fromLonLat([0, 0]), 10),\r\n  });\r\n\r\n  const userPositionLayer = new VectorLayer({\r\n    source: new VectorSource({\r\n      features: [accuracyFeature, userPositionFeature],\r\n    }),\r\n    style: (feature) => {\r\n      if (feature === userPositionFeature) {\r\n        return new Style({\r\n          image: new CircleStyle({\r\n            radius: 8,\r\n            fill: new Fill({ color: \"#ff0000\" }),\r\n            stroke: new Stroke({ color: \"#ffffff\", width: 2 }),\r\n          }),\r\n        });\r\n      } else if (feature === accuracyFeature) {\r\n        return new Style({\r\n          fill: new Fill({ color: \"rgba(0, 0, 255, 0.2)\" }),\r\n          stroke: new Stroke({ color: \"blue\", width: 1 }),\r\n        });\r\n      }\r\n      return new Style();\r\n    },\r\n  });\r\n\r\n  map.addLayer(userPositionLayer);\r\n\r\n  // Better approach to update user position\r\n  const updateUserPosition = (position: GeolocationPosition) => {\r\n    if (isUpdatingPositionRef.current) return; // Prevent concurrent updates\r\n\r\n    isUpdatingPositionRef.current = true;\r\n\r\n    try {\r\n      const { latitude, longitude, accuracy } = position.coords;\r\n      const coords = fromLonLat([longitude, latitude]);\r\n\r\n      // Update geometry directly without changing state if possible\r\n      userPositionFeature.setGeometry(new Point(coords));\r\n      accuracyFeature.setGeometry(new CircleGeometry(coords, accuracy || 10));\r\n\r\n      // Check if the user is outside the school boundary\r\n      const isOutside =\r\n        schoolBoundaryRef.current &&\r\n        !isCoordinateInsideSchool(coords, schoolBoundaryRef.current);\r\n\r\n      // Only update ref if it has changed - no state updates here\r\n      if (isOutside !== isOutsideSchoolRef.current) {\r\n        isOutsideSchoolRef.current = !!isOutside;\r\n\r\n        if (isOutside) {\r\n        }\r\n      }\r\n    } finally {\r\n      // Make sure we reset the flag even if there's an error\r\n      isUpdatingPositionRef.current = false;\r\n    }\r\n  };\r\n\r\n  const watchId = navigator.geolocation.watchPosition(\r\n    updateUserPosition,\r\n    (error) => {\r\n      console.error(\"Error getting location:\", error);\r\n      // Update ref instead of state directly\r\n      const errorMsg = `Location error: ${error.message}`;\r\n      if (locationErrorRef.current !== errorMsg) {\r\n        locationErrorRef.current = errorMsg;\r\n      }\r\n    },\r\n    {\r\n      enableHighAccuracy: true,\r\n      maximumAge: 5000,\r\n      timeout: 10000,\r\n    }\r\n  );\r\n\r\n  return {\r\n    watchId,\r\n    userPositionFeature,\r\n    accuracyFeature,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 652, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 658, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/enhancedLocationTracking.ts"],"sourcesContent":["import { Fill, Stroke, Style, Icon } from \"ol/style\";\r\nimport Feature from \"ol/Feature\";\r\nimport Point from \"ol/geom/Point\";\r\nimport { fromLonLat, toLonLat } from \"ol/proj\";\r\nimport { Circle as CircleGeometry } from \"ol/geom\";\r\nimport VectorLayer from \"ol/layer/Vector\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport CircleStyle from \"ol/style/Circle\";\r\nimport { Extent } from \"ol/extent\";\r\nimport { containsCoordinate } from \"ol/extent\";\r\nimport Map from \"ol/Map\";\r\nimport { MutableRefObject } from \"react\";\r\nimport { LineString } from \"ol/geom\";\r\nimport { getDistance } from \"ol/sphere\";\r\n\r\n// =============================================\r\n// Enhanced Location Tracking Types\r\n// =============================================\r\n\r\nexport interface LocationTrackingOptions {\r\n  autoFollow: boolean; // Auto-center map on user\r\n  rotateMap: boolean; // Rotate map based on heading\r\n  smoothAnimation: boolean; // Smooth camera transitions\r\n  animationDuration: number; // Animation duration in ms\r\n  zoomLevel: number; // Zoom level for auto-follow\r\n  showAccuracyCircle: boolean; // Show GPS accuracy\r\n  showDirectionArrow: boolean; // Show direction indicator\r\n  trackingMode: \"normal\" | \"compass\" | \"route\"; // Tracking mode\r\n}\r\n\r\nexport interface UserPosition {\r\n  coordinates: [number, number]; // [longitude, latitude]\r\n  accuracy: number; // GPS accuracy in meters\r\n  heading: number | null; // Direction of travel in degrees (0 = North)\r\n  speed: number | null; // Speed in m/s\r\n  timestamp: number; // Position timestamp\r\n}\r\n\r\nexport interface RouteProgress {\r\n  distanceToDestination: number; // Distance remaining in meters\r\n  distanceTraveled: number; // Distance traveled in meters\r\n  percentComplete: number; // Percentage of route completed\r\n  estimatedTimeRemaining: number; // ETA in seconds\r\n  isOffRoute: boolean; // Whether user is off the planned route\r\n  distanceFromRoute: number; // Distance from route in meters\r\n  nextWaypoint: [number, number] | null; // Next waypoint coordinates\r\n  distanceToNextWaypoint: number; // Distance to next waypoint\r\n  bearingToNextWaypoint: number | null; // Bearing to next waypoint in degrees\r\n}\r\n\r\n// =============================================\r\n// Helper Functions\r\n// =============================================\r\n\r\n// Calculate bearing between two points (in degrees, 0 = North)\r\nexport const calculateBearing = (\r\n  start: [number, number],\r\n  end: [number, number]\r\n): number => {\r\n  const [lon1, lat1] = start;\r\n  const [lon2, lat2] = end;\r\n\r\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\r\n  const lat1Rad = (lat1 * Math.PI) / 180;\r\n  const lat2Rad = (lat2 * Math.PI) / 180;\r\n\r\n  const y = Math.sin(dLon) * Math.cos(lat2Rad);\r\n  const x =\r\n    Math.cos(lat1Rad) * Math.sin(lat2Rad) -\r\n    Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);\r\n\r\n  const bearingRad = Math.atan2(y, x);\r\n  const bearingDeg = (bearingRad * 180) / Math.PI;\r\n\r\n  return (bearingDeg + 360) % 360;\r\n};\r\n\r\n// Calculate distance between two geographic coordinates (in meters)\r\nexport const calculateDistance = (\r\n  coord1: [number, number],\r\n  coord2: [number, number]\r\n): number => {\r\n  const point1 = fromLonLat(coord1);\r\n  const point2 = fromLonLat(coord2);\r\n  return getDistance(point1, point2);\r\n};\r\n\r\n// Smooth angle interpolation (handles wrapping)\r\nconst interpolateAngle = (\r\n  current: number,\r\n  target: number,\r\n  factor: number\r\n): number => {\r\n  let diff = target - current;\r\n\r\n  // Normalize to [-180, 180]\r\n  while (diff > 180) diff -= 360;\r\n  while (diff < -180) diff += 360;\r\n\r\n  return current + diff * factor;\r\n};\r\n\r\n// Check if coordinate is within school boundary\r\nexport const isCoordinateInsideSchool = (\r\n  coords: number[],\r\n  boundary: Extent | null\r\n): boolean => {\r\n  if (!boundary) return true;\r\n  return containsCoordinate(boundary, coords);\r\n};\r\n\r\n// =============================================\r\n// Enhanced Location Tracking System\r\n// =============================================\r\n\r\nexport class EnhancedLocationTracker {\r\n  private map: Map;\r\n  private options: LocationTrackingOptions;\r\n  // Feature references\r\n  private userPositionFeature: Feature;\r\n  private accuracyFeature: Feature;\r\n  private directionArrowFeature: Feature;\r\n  private userPositionLayer: VectorLayer<VectorSource>;\r\n\r\n  // Position tracking\r\n  private currentPosition: UserPosition | null = null;\r\n  private previousPosition: UserPosition | null = null;\r\n  private watchId: number | null = null;\r\n  private positionHistory: UserPosition[] = [];\r\n  private maxHistoryLength = 10;\r\n\r\n  // Route tracking\r\n  private routePath: [number, number][] = [];\r\n  private startPosition: [number, number] | null = null;\r\n  private destinationPosition: [number, number] | null = null;\r\n  private totalRouteDistance: number = 0;\r\n\r\n  // Animation\r\n  private animationFrameId: number | null = null;\r\n  private targetRotation: number = 0;\r\n  private currentRotation: number = 0;\r\n\r\n  // Callbacks\r\n  private onPositionUpdate?: (position: UserPosition) => void;\r\n  private onRouteProgressUpdate?: (progress: RouteProgress) => void;\r\n  private locationErrorRef: MutableRefObject<string | null>;\r\n  private isOutsideSchoolRef: MutableRefObject<boolean>;\r\n  private schoolBoundaryRef: MutableRefObject<Extent | null>;\r\n\r\n  constructor(\r\n    map: Map,\r\n    options: Partial<LocationTrackingOptions>,\r\n    locationErrorRef: MutableRefObject<string | null>,\r\n    isOutsideSchoolRef: MutableRefObject<boolean>,\r\n    schoolBoundaryRef: MutableRefObject<Extent | null>\r\n  ) {\r\n    this.map = map;\r\n    this.locationErrorRef = locationErrorRef;\r\n    this.isOutsideSchoolRef = isOutsideSchoolRef;\r\n    this.schoolBoundaryRef = schoolBoundaryRef;\r\n\r\n    // Default options\r\n    this.options = {\r\n      autoFollow: true,\r\n      rotateMap: true,\r\n      smoothAnimation: true,\r\n      animationDuration: 1000,\r\n      zoomLevel: 19,\r\n      showAccuracyCircle: true,\r\n      showDirectionArrow: true,\r\n      trackingMode: \"route\",\r\n      ...options,\r\n    };\r\n\r\n    // Initialize features\r\n    this.userPositionFeature = new Feature({\r\n      geometry: new Point(fromLonLat([0, 0])),\r\n      name: \"userPosition\",\r\n    });\r\n\r\n    this.accuracyFeature = new Feature({\r\n      geometry: new CircleGeometry(fromLonLat([0, 0]), 10),\r\n      name: \"accuracy\",\r\n    });\r\n\r\n    // Create direction arrow using SVG data URL\r\n    const arrowSvg = this.createDirectionArrowSVG();\r\n    this.directionArrowFeature = new Feature({\r\n      geometry: new Point(fromLonLat([0, 0])),\r\n      name: \"directionArrow\",\r\n    });\r\n\r\n    // Create layer with styled features\r\n    this.userPositionLayer = new VectorLayer({\r\n      source: new VectorSource({\r\n        features: [\r\n          this.accuracyFeature,\r\n          this.userPositionFeature,\r\n          this.directionArrowFeature,\r\n        ],\r\n      }),\r\n      style: (feature) => this.getFeatureStyle(feature),\r\n      zIndex: 1000, // High z-index to render on top\r\n    });\r\n\r\n    this.map.addLayer(this.userPositionLayer);\r\n\r\n  }\r\n\r\n  // =============================================\r\n  // Styling\r\n  // =============================================\r\n\r\n  private createDirectionArrowSVG(): string {\r\n    const svg = `\r\n      <svg width=\"40\" height=\"40\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <defs>\r\n          <filter id=\"shadow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\r\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"2\"/>\r\n            <feOffset dx=\"0\" dy=\"1\" result=\"offsetblur\"/>\r\n            <feComponentTransfer>\r\n              <feFuncA type=\"linear\" slope=\"0.3\"/>\r\n            </feComponentTransfer>\r\n            <feMerge>\r\n              <feMergeNode/>\r\n              <feMergeNode in=\"SourceGraphic\"/>\r\n            </feMerge>\r\n          </filter>\r\n        </defs>\r\n        <circle cx=\"20\" cy=\"20\" r=\"18\" fill=\"#3B82F6\" opacity=\"0.3\"/>\r\n        <circle cx=\"20\" cy=\"20\" r=\"14\" fill=\"#3B82F6\" stroke=\"white\" stroke-width=\"2\" filter=\"url(#shadow)\"/>\r\n        <path d=\"M20 8 L26 24 L20 20 L14 24 Z\" fill=\"white\" filter=\"url(#shadow)\"/>\r\n      </svg>\r\n    `;\r\n    return \"data:image/svg+xml,\" + encodeURIComponent(svg);\r\n  }\r\n\r\n  private getFeatureStyle(feature: Feature): Style {\r\n    const name = feature.get(\"name\");\r\n\r\n    if (name === \"userPosition\") {\r\n      // Pulsing user position dot\r\n      return new Style({\r\n        image: new CircleStyle({\r\n          radius: 10,\r\n          fill: new Fill({ color: \"#3B82F6\" }),\r\n          stroke: new Stroke({ color: \"#ffffff\", width: 3 }),\r\n        }),\r\n      });\r\n    } else if (name === \"accuracy\" && this.options.showAccuracyCircle) {\r\n      // Accuracy circle\r\n      return new Style({\r\n        fill: new Fill({ color: \"rgba(59, 130, 246, 0.1)\" }),\r\n        stroke: new Stroke({ color: \"#3B82F6\", width: 1.5, lineDash: [5, 5] }),\r\n      });\r\n    } else if (name === \"directionArrow\" && this.options.showDirectionArrow) {\r\n      // Direction arrow\r\n      const rotation = this.currentPosition?.heading || 0;\r\n      return new Style({\r\n        image: new Icon({\r\n          src: this.createDirectionArrowSVG(),\r\n          scale: 0.8,\r\n          rotation: (rotation * Math.PI) / 180, // Convert to radians\r\n          rotateWithView: false, // We handle rotation ourselves\r\n        }),\r\n      });\r\n    }\r\n\r\n    return new Style();\r\n  }\r\n\r\n  // =============================================\r\n  // Position Tracking\r\n  // =============================================\r\n\r\n  public startTracking(\r\n    onPositionUpdate?: (position: UserPosition) => void,\r\n    onRouteProgressUpdate?: (progress: RouteProgress) => void\r\n  ): void {\r\n    this.onPositionUpdate = onPositionUpdate;\r\n    this.onRouteProgressUpdate = onRouteProgressUpdate;\r\n\r\n    if (this.watchId !== null) {\r\n      return;\r\n    }\r\n\r\n\r\n    this.watchId = navigator.geolocation.watchPosition(\r\n      (position) => this.handlePositionUpdate(position),\r\n      (error) => this.handlePositionError(error),\r\n      {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 1000, // More frequent updates for mobile\r\n        timeout: 15000,\r\n      }\r\n    );\r\n\r\n    // Start animation loop\r\n    this.startAnimationLoop();\r\n  }\r\n\r\n  public stopTracking(): void {\r\n    if (this.watchId !== null) {\r\n      navigator.geolocation.clearWatch(this.watchId);\r\n      this.watchId = null;\r\n    }\r\n\r\n    if (this.animationFrameId !== null) {\r\n      cancelAnimationFrame(this.animationFrameId);\r\n      this.animationFrameId = null;\r\n    }\r\n  }\r\n\r\n  private handlePositionUpdate(geoPosition: GeolocationPosition): void {\r\n    const { latitude, longitude, accuracy, heading, speed } = geoPosition.coords;\r\n\r\n    // Calculate derived heading from movement if not provided by device\r\n    let effectiveHeading = heading;\r\n    if (\r\n      this.previousPosition &&\r\n      (heading === null || heading === undefined)\r\n    ) {\r\n      effectiveHeading = calculateBearing(\r\n        this.previousPosition.coordinates,\r\n        [longitude, latitude]\r\n      );\r\n    }\r\n\r\n    const newPosition: UserPosition = {\r\n      coordinates: [longitude, latitude],\r\n      accuracy: accuracy || 10,\r\n      heading: effectiveHeading,\r\n      speed: speed,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Update position history\r\n    this.previousPosition = this.currentPosition;\r\n    this.currentPosition = newPosition;\r\n\r\n    this.positionHistory.push(newPosition);\r\n    if (this.positionHistory.length > this.maxHistoryLength) {\r\n      this.positionHistory.shift();\r\n    }\r\n\r\n    // Record start position if not set\r\n    if (!this.startPosition) {\r\n      this.startPosition = [longitude, latitude];\r\n    }\r\n\r\n    // Update map features\r\n    this.updateMapFeatures();\r\n\r\n    // Check boundary\r\n    this.checkBoundary();\r\n\r\n    // Auto-follow if enabled\r\n    if (this.options.autoFollow) {\r\n      this.centerMapOnUser();\r\n    }\r\n\r\n    // Calculate route progress\r\n    if (this.destinationPosition) {\r\n      const progress = this.calculateRouteProgress();\r\n      if (this.onRouteProgressUpdate) {\r\n        this.onRouteProgressUpdate(progress);\r\n      }\r\n    }\r\n\r\n    // Callback\r\n    if (this.onPositionUpdate) {\r\n      this.onPositionUpdate(newPosition);\r\n    }\r\n  }\r\n\r\n  private handlePositionError(error: GeolocationPositionError): void {\r\n    const errorMsg = `Location error: ${error.message}`;\r\n    this.locationErrorRef.current = errorMsg;\r\n  }\r\n\r\n  private updateMapFeatures(): void {\r\n    if (!this.currentPosition) return;\r\n\r\n    const coords = fromLonLat(this.currentPosition.coordinates);\r\n\r\n    // Update position marker\r\n    this.userPositionFeature.setGeometry(new Point(coords));\r\n\r\n    // Update accuracy circle\r\n    this.accuracyFeature.setGeometry(\r\n      new CircleGeometry(coords, this.currentPosition.accuracy)\r\n    );\r\n\r\n    // Update direction arrow\r\n    this.directionArrowFeature.setGeometry(new Point(coords));\r\n\r\n    // Refresh styles\r\n    this.userPositionLayer.changed();\r\n  }\r\n\r\n  private checkBoundary(): void {\r\n    if (!this.currentPosition || !this.schoolBoundaryRef.current) return;\r\n\r\n    const coords = fromLonLat(this.currentPosition.coordinates);\r\n    const isOutside = !isCoordinateInsideSchool(\r\n      coords,\r\n      this.schoolBoundaryRef.current\r\n    );\r\n\r\n    if (isOutside !== this.isOutsideSchoolRef.current) {\r\n      this.isOutsideSchoolRef.current = isOutside;\r\n      if (isOutside) {\r\n      }\r\n    }\r\n  }\r\n\r\n  // =============================================\r\n  // Map Control\r\n  // =============================================\r\n\r\n  private centerMapOnUser(): void {\r\n    if (!this.currentPosition) return;\r\n\r\n    const view = this.map.getView();\r\n    const coords = fromLonLat(this.currentPosition.coordinates);\r\n\r\n    if (this.options.smoothAnimation) {\r\n      view.animate({\r\n        center: coords,\r\n        zoom: this.options.zoomLevel,\r\n        duration: 500, // Smooth transition\r\n      });\r\n    } else {\r\n      view.setCenter(coords);\r\n      view.setZoom(this.options.zoomLevel);\r\n    }\r\n  }\r\n\r\n  private startAnimationLoop(): void {\r\n    const animate = () => {\r\n      if (\r\n        this.options.rotateMap &&\r\n        this.currentPosition?.heading !== null &&\r\n        this.currentPosition?.heading !== undefined\r\n      ) {\r\n        // Smooth rotation interpolation\r\n        const targetRotation = -((this.currentPosition.heading * Math.PI) / 180);\r\n        this.currentRotation = interpolateAngle(\r\n          this.currentRotation,\r\n          targetRotation,\r\n          0.1 // Smoothing factor\r\n        );\r\n\r\n        const view = this.map.getView();\r\n        view.setRotation(this.currentRotation);\r\n      }\r\n\r\n      this.animationFrameId = requestAnimationFrame(animate);\r\n    };\r\n\r\n    animate();\r\n  }\r\n\r\n  // =============================================\r\n  // Route Management\r\n  // =============================================\r\n\r\n  public setRoute(path: [number, number][]): void {\r\n    this.routePath = path;\r\n\r\n    if (path.length > 0) {\r\n      this.destinationPosition = path[path.length - 1];\r\n\r\n      // Calculate total route distance\r\n      this.totalRouteDistance = 0;\r\n      for (let i = 0; i < path.length - 1; i++) {\r\n        this.totalRouteDistance += calculateDistance(path[i], path[i + 1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearRoute(): void {\r\n    this.routePath = [];\r\n    this.destinationPosition = null;\r\n    this.totalRouteDistance = 0;\r\n    this.startPosition = null;\r\n  }\r\n\r\n  private calculateRouteProgress(): RouteProgress {\r\n    if (\r\n      !this.currentPosition ||\r\n      !this.destinationPosition ||\r\n      this.routePath.length === 0\r\n    ) {\r\n      return {\r\n        distanceToDestination: 0,\r\n        distanceTraveled: 0,\r\n        percentComplete: 0,\r\n        estimatedTimeRemaining: 0,\r\n        isOffRoute: false,\r\n        distanceFromRoute: 0,\r\n        nextWaypoint: null,\r\n        distanceToNextWaypoint: 0,\r\n        bearingToNextWaypoint: null,\r\n      };\r\n    }\r\n\r\n    const userCoords = this.currentPosition.coordinates;\r\n\r\n    // Distance to destination\r\n    const distanceToDestination = calculateDistance(\r\n      userCoords,\r\n      this.destinationPosition\r\n    );\r\n\r\n    // Distance traveled (from start)\r\n    const distanceTraveled = this.startPosition\r\n      ? calculateDistance(this.startPosition, userCoords)\r\n      : 0;\r\n\r\n    // Percent complete\r\n    const percentComplete =\r\n      this.totalRouteDistance > 0\r\n        ? Math.min(\r\n            100,\r\n            ((this.totalRouteDistance - distanceToDestination) /\r\n              this.totalRouteDistance) *\r\n              100\r\n          )\r\n        : 0;\r\n\r\n    // Find next waypoint\r\n    let nextWaypoint: [number, number] | null = null;\r\n    let minDistanceToWaypoint = Infinity;\r\n\r\n    for (const waypoint of this.routePath) {\r\n      const dist = calculateDistance(userCoords, waypoint);\r\n      if (dist < minDistanceToWaypoint) {\r\n        minDistanceToWaypoint = dist;\r\n        nextWaypoint = waypoint;\r\n      }\r\n    }\r\n\r\n    // Bearing to next waypoint\r\n    const bearingToNextWaypoint = nextWaypoint\r\n      ? calculateBearing(userCoords, nextWaypoint)\r\n      : null;\r\n\r\n    // Check if off route (more than 50m from any waypoint)\r\n    const isOffRoute = minDistanceToWaypoint > 50;\r\n\r\n    // Estimated time remaining (based on average walking speed 1.4 m/s)\r\n    const walkingSpeed = this.currentPosition.speed || 1.4;\r\n    const estimatedTimeRemaining = distanceToDestination / walkingSpeed;\r\n\r\n    return {\r\n      distanceToDestination,\r\n      distanceTraveled,\r\n      percentComplete,\r\n      estimatedTimeRemaining,\r\n      isOffRoute,\r\n      distanceFromRoute: minDistanceToWaypoint,\r\n      nextWaypoint,\r\n      distanceToNextWaypoint: minDistanceToWaypoint,\r\n      bearingToNextWaypoint,\r\n    };\r\n  }\r\n\r\n  // =============================================\r\n  // Configuration\r\n  // =============================================\r\n\r\n  public setOptions(options: Partial<LocationTrackingOptions>): void {\r\n    this.options = { ...this.options, ...options };\r\n    this.userPositionLayer.changed(); // Refresh styles\r\n  }\r\n\r\n  public getOptions(): LocationTrackingOptions {\r\n    return { ...this.options };\r\n  }\r\n\r\n  public getCurrentPosition(): UserPosition | null {\r\n    return this.currentPosition;\r\n  }\r\n\r\n  public getPositionHistory(): UserPosition[] {\r\n    return [...this.positionHistory];\r\n  }\r\n\r\n  // =============================================\r\n  // Utilities\r\n  // =============================================\r\n\r\n  public destroy(): void {\r\n    this.stopTracking();\r\n    this.map.removeLayer(this.userPositionLayer);\r\n  }\r\n}\r\n\r\n// =============================================\r\n// Export Factory Function\r\n// =============================================\r\n\r\nexport const setupEnhancedLocationTracking = (\r\n  map: Map,\r\n  options: Partial<LocationTrackingOptions>,\r\n  locationErrorRef: MutableRefObject<string | null>,\r\n  isOutsideSchoolRef: MutableRefObject<boolean>,\r\n  schoolBoundaryRef: MutableRefObject<Extent | null>\r\n): EnhancedLocationTracker => {\r\n  return new EnhancedLocationTracker(\r\n    map,\r\n    options,\r\n    locationErrorRef,\r\n    isOutsideSchoolRef,\r\n    schoolBoundaryRef\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1118, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1124, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/editControls.ts"],"sourcesContent":["import { Fill, Stroke, Style } from \"ol/style\";\r\nimport Draw from \"ol/interaction/Draw\";\r\nimport Modify from \"ol/interaction/Modify\";\r\nimport Select from \"ol/interaction/Select\";\r\nimport { click } from \"ol/events/condition\";\r\nimport { saveAs } from \"file-saver\";\r\nimport Feature from \"ol/Feature\";\r\nimport GeoJSON from \"ol/format/GeoJSON\";\r\nimport CircleStyle from \"ol/style/Circle\";\r\nimport Collection from \"ol/Collection\";\r\nimport Geometry from \"ol/geom/Geometry\";\r\nimport Point from \"ol/geom/Point\";\r\nimport Map from \"ol/Map\";\r\nimport { MutableRefObject } from \"react\";\r\nimport { fromLonLat } from \"ol/proj\";\r\nimport { Polygon } from \"ol/geom\";\r\n\r\nimport { getRandomColor, hexToRGBA } from \"./layers\";\r\n\r\n// Export GeoJSON data\r\nexport const exportGeoJSON = (\r\n  source: any,\r\n  filename: string,\r\n) => {\r\n  const features = source.getFeatures();\r\n  const geoJsonFormat = new GeoJSON({\r\n    dataProjection: \"EPSG:4326\",\r\n    featureProjection: \"EPSG:3857\",\r\n  });\r\n\r\n  const geoJsonStr = geoJsonFormat.writeFeatures(features);\r\n  const blob = new Blob([geoJsonStr], { type: \"application/json\" });\r\n  saveAs(blob, filename);\r\n};\r\n\r\n// Add marker functionality\r\nexport const addMarker = (\r\n  lon: number,\r\n  lat: number,\r\n  pointsSource: any,\r\n  options: any = {},\r\n) => {\r\n  if (!pointsSource) return;\r\n\r\n  const feature = new Feature({\r\n    geometry: new Point(fromLonLat([lon, lat])),\r\n    ...options,\r\n  });\r\n\r\n  // Set default properties if not provided\r\n  if (!options[\"marker-color\"]) {\r\n    feature.set(\"marker-color\", getRandomColor());\r\n  }\r\n  if (!options[\"marker-size\"]) {\r\n    feature.set(\"marker-size\", \"medium\");\r\n  }\r\n  if (!options.name) {\r\n    feature.set(\"name\", `Marker ${pointsSource.getFeatures().length + 1}`);\r\n  }\r\n\r\n  pointsSource.addFeature(feature);\r\n  return feature;\r\n};\r\n\r\n// Add polygon functionality\r\nexport const addPolygon = (\r\n  coordinates: number[][],\r\n  vectorSource: any,\r\n  options: any = {},\r\n) => {\r\n  if (!vectorSource) return;\r\n\r\n  const transformedCoords = coordinates.map((coord) => fromLonLat(coord));\r\n  const feature = new Feature({\r\n    geometry: new Polygon([transformedCoords]),\r\n    ...options,\r\n  });\r\n\r\n  // Set default properties if not provided\r\n  if (!options.fill) {\r\n    feature.set(\"fill\", getRandomColor());\r\n  }\r\n  if (!options[\"fill-opacity\"]) {\r\n    feature.set(\"fill-opacity\", 0.5);\r\n  }\r\n  if (!options.stroke) {\r\n    feature.set(\"stroke\", \"#000000\");\r\n  }\r\n  if (!options.strokeWidth) {\r\n    feature.set(\"strokeWidth\", 2);\r\n  }\r\n  if (!options.name) {\r\n    feature.set(\"name\", `Polygon ${vectorSource.getFeatures().length + 1}`);\r\n  }\r\n\r\n  vectorSource.addFeature(feature);\r\n  return feature;\r\n};\r\n\r\n// Delete selected feature\r\nexport const deleteSelectedFeature = (\r\n  selectInteraction: Select | null,\r\n  vectorSource: any,\r\n  pointsSource: any,\r\n  setShowCustomizePanel: (show: boolean) => void,\r\n  setSelectedFeature: (feature: Feature | null) => void,\r\n) => {\r\n  if (!selectInteraction) return;\r\n\r\n  const selectedFeatures = selectInteraction.getFeatures();\r\n  if (selectedFeatures.getLength() === 0) {\r\n    return;\r\n  }\r\n\r\n  const feature = selectedFeatures.item(0);\r\n  if (!feature) return;\r\n\r\n  // Try to remove from both sources\r\n  vectorSource.removeFeature(feature);\r\n  pointsSource.removeFeature(feature);\r\n\r\n  // Close customization panel and clear selection\r\n  setShowCustomizePanel(false);\r\n  setSelectedFeature(null);\r\n  selectedFeatures.clear();\r\n};\r\n\r\n// Setup edit controls\r\nexport const setupEditControls = (\r\n  editMode: boolean,\r\n  map: Map,\r\n  vectorSource: any,\r\n  pointsSource: any,\r\n  modifyInteractionRef: MutableRefObject<Modify | null>,\r\n  selectInteractionRef: MutableRefObject<Select | null>,\r\n  drawInteractionRef: MutableRefObject<Draw | null>,\r\n  setSelectedFeature: (feature: Feature | null) => void,\r\n  setFeatureProperties: (props: { [key: string]: any }) => void,\r\n  setShowCustomizePanel: (show: boolean) => void,\r\n  setDrawType: (type: \"Point\" | \"LineString\" | \"Polygon\" | null) => void,\r\n) => {\r\n  // Remove existing interactions\r\n  if (modifyInteractionRef.current) {\r\n    map.removeInteraction(modifyInteractionRef.current);\r\n    modifyInteractionRef.current = null;\r\n  }\r\n  if (selectInteractionRef.current) {\r\n    map.removeInteraction(selectInteractionRef.current);\r\n    selectInteractionRef.current = null;\r\n  }\r\n  if (drawInteractionRef.current) {\r\n    map.removeInteraction(drawInteractionRef.current);\r\n    drawInteractionRef.current = null;\r\n  }\r\n\r\n  if (!editMode) {\r\n    return;\r\n  }\r\n\r\n\r\n  // Create select interaction\r\n  const select = new Select({\r\n    condition: click,\r\n    style: (feature) => {\r\n      const properties = feature.getProperties();\r\n      const isPoint = feature.getGeometry() instanceof Point;\r\n\r\n      if (isPoint) {\r\n        const color = properties[\"marker-color\"] || \"#ff0000\";\r\n        const size =\r\n          properties[\"marker-size\"] === \"large\"\r\n            ? 12\r\n            : properties[\"marker-size\"] === \"medium\"\r\n              ? 8\r\n              : 6;\r\n\r\n        return new Style({\r\n          image: new CircleStyle({\r\n            radius: size,\r\n            fill: new Fill({ color }),\r\n            stroke: new Stroke({ color: \"#ffffff\", width: 2 }),\r\n          }),\r\n        });\r\n      } else {\r\n        const fillColor = properties.fill || properties.fillColor || \"#0080ff\";\r\n        const strokeColor =\r\n          properties.stroke || properties.strokeColor || \"#000000\";\r\n        const fillOpacity = properties[\"fill-opacity\"] ?? 0.5;\r\n\r\n        return new Style({\r\n          fill: new Fill({\r\n            color: hexToRGBA(fillColor, fillOpacity),\r\n          }),\r\n          stroke: new Stroke({\r\n            color: \"#ffffff\",\r\n            width: 4,\r\n          }),\r\n        });\r\n      }\r\n    },\r\n  });\r\n\r\n  // Handle feature selection\r\n  select.on(\"select\", (event) => {\r\n    const feature = event.selected[0];\r\n\r\n    if (feature) {\r\n      const properties = feature.getProperties();\r\n      delete properties.geometry; // Remove geometry from properties display\r\n\r\n      setSelectedFeature(feature);\r\n      setFeatureProperties(properties);\r\n      setShowCustomizePanel(true);\r\n\r\n    } else {\r\n      setSelectedFeature(null);\r\n      setFeatureProperties({});\r\n      setShowCustomizePanel(false);\r\n    }\r\n  });\r\n\r\n  // Create modify interaction\r\n  const modify = new Modify({\r\n    features: select.getFeatures(),\r\n  });\r\n\r\n  // Add interactions to map\r\n  map.addInteraction(select);\r\n  map.addInteraction(modify);\r\n\r\n  // Save references\r\n  selectInteractionRef.current = select;\r\n  modifyInteractionRef.current = modify;\r\n\r\n  setDrawType(null);\r\n};\r\n\r\n// Toggle draw interaction\r\nexport const toggleDrawInteraction = (\r\n  type: \"Point\" | \"LineString\" | \"Polygon\" | null,\r\n  editMode: boolean,\r\n  map: Map | null,\r\n  vectorSource: any,\r\n  pointsSource: any,\r\n  drawInteractionRef: MutableRefObject<Draw | null>,\r\n  selectInteractionRef: MutableRefObject<Select | null>,\r\n  setSelectedFeature: (feature: Feature | null) => void,\r\n  setFeatureProperties: (props: { [key: string]: any }) => void,\r\n  setShowCustomizePanel: (show: boolean) => void,\r\n) => {\r\n  if (!map || !editMode) return;\r\n\r\n  // Remove existing draw interaction\r\n  if (drawInteractionRef.current) {\r\n    map.removeInteraction(drawInteractionRef.current);\r\n    drawInteractionRef.current = null;\r\n  }\r\n\r\n  if (!type) {\r\n    return;\r\n  }\r\n\r\n  // Create draw interaction with the appropriate source\r\n  const source = type === \"Point\" ? pointsSource : vectorSource;\r\n\r\n  const draw = new Draw({\r\n    source: source,\r\n    type: type,\r\n    style: new Style({\r\n      fill: new Fill({\r\n        color: \"rgba(255, 204, 51, 0.2)\",\r\n      }),\r\n      stroke: new Stroke({\r\n        color: \"#ffcc33\",\r\n        width: 2,\r\n      }),\r\n      image: new CircleStyle({\r\n        radius: 7,\r\n        fill: new Fill({\r\n          color: \"#ffcc33\",\r\n        }),\r\n      }),\r\n    }),\r\n  });\r\n\r\n  // Set default properties for new features\r\n  draw.on(\"drawend\", (event) => {\r\n    const feature = event.feature;\r\n\r\n    if (type === \"Point\") {\r\n      feature.set(\"marker-color\", getRandomColor());\r\n      feature.set(\"marker-size\", \"medium\");\r\n      feature.set(\"name\", `Marker ${pointsSource.getFeatures().length + 1}`);\r\n    } else {\r\n      feature.set(\"fill\", getRandomColor());\r\n      feature.set(\"fill-opacity\", 0.5);\r\n      feature.set(\"stroke\", \"#000000\");\r\n      feature.set(\"strokeWidth\", 2);\r\n      feature.set(\"name\", `${type} ${vectorSource.getFeatures().length + 1}`);\r\n    }\r\n\r\n    // Select the newly created feature\r\n    if (selectInteractionRef.current) {\r\n      const selected = selectInteractionRef.current.getFeatures();\r\n      selected.clear();\r\n      selected.push(feature);\r\n\r\n      const properties = feature.getProperties();\r\n      delete properties.geometry;\r\n\r\n      setSelectedFeature(feature);\r\n      setFeatureProperties(properties);\r\n      setShowCustomizePanel(true);\r\n    }\r\n  });\r\n\r\n  map.addInteraction(draw);\r\n  drawInteractionRef.current = draw;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1385, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1391, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/components.tsx"],"sourcesContent":["import React, { ChangeEvent } from \"react\";\r\nimport {\r\n  EditControlsProps,\r\n  CustomizationPanelProps,\r\n} from \"./types\";\r\n\r\n// Edit Controls Component\r\nexport const EditControls: React.FC<EditControlsProps> = ({\r\n  isEditMode,\r\n  toggleEditMode,\r\n  drawType,\r\n  handleDrawInteractionToggle,\r\n  handleDeleteSelected,\r\n  handleExportMap,\r\n}) => (\r\n  <div className=\"absolute top-4 right-4 z-10 bg-white bg-opacity-90 p-3 rounded-lg shadow-lg\">\r\n    <div className=\"flex flex-col space-y-2\">\r\n      <button\r\n        className={`px-3 py-2 rounded-md text-sm font-medium ${\r\n          isEditMode ? \"bg-blue-500 text-white\" : \"bg-gray-200 text-gray-800\"\r\n        }`}\r\n        onClick={toggleEditMode}\r\n      >\r\n        {isEditMode ? \"Exit Edit Mode\" : \"Edit Map\"}\r\n      </button>\r\n\r\n      {isEditMode && (\r\n        <>\r\n          <div className=\"flex space-x-2\">\r\n            {([\"Point\", \"LineString\", \"Polygon\"] as const).map((type) => (\r\n              <button\r\n                key={type}\r\n                className={`px-3 py-1 text-xs rounded-md ${\r\n                  drawType === type ? \"bg-green-500 text-white\" : \"bg-gray-200\"\r\n                }`}\r\n                onClick={() => handleDrawInteractionToggle(type)}\r\n              >\r\n                {type === \"LineString\"\r\n                  ? \"Line\"\r\n                  : type === \"Polygon\"\r\n                    ? \"Area\"\r\n                    : \"Point\"}\r\n              </button>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex space-x-2\">\r\n            <button\r\n              className=\"px-3 py-1 text-xs bg-red-500 text-white rounded-md\"\r\n              onClick={handleDeleteSelected}\r\n            >\r\n              Delete\r\n            </button>\r\n            <button\r\n              className=\"px-3 py-1 text-xs bg-gray-700 text-white rounded-md\"\r\n              onClick={handleExportMap}\r\n            >\r\n              Export\r\n            </button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// Customization Panel Component\r\nexport const CustomizationPanel: React.FC<CustomizationPanelProps> = ({\r\n  featureProperties,\r\n  updateFeatureProperty,\r\n  markerSizeOptions,\r\n  onClose,\r\n}) => {\r\n  const isPoint =\r\n    featureProperties?.geometry?.getType?.() === \"Point\" ||\r\n    featureProperties?.[\"marker-color\"] !== undefined;\r\n\r\n  return (\r\n    <div className=\"absolute top-4 left-4 z-10 bg-white bg-opacity-90 p-4 rounded-lg shadow-lg w-64\">\r\n      <div className=\"flex justify-between items-center mb-3\">\r\n        <h3 className=\"font-bold\">Customize Feature</h3>\r\n        <button className=\"text-gray-500 hover:text-gray-700\" onClick={onClose}>\r\n          ✕\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"space-y-3\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Name</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full px-2 py-1 border rounded\"\r\n            value={featureProperties?.name ?? \"\"}\r\n            onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n              updateFeatureProperty(\"name\", e.target.value)\r\n            }\r\n          />\r\n        </div>\r\n\r\n        {isPoint ? (\r\n          <>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">\r\n                Marker Color\r\n              </label>\r\n              <input\r\n                type=\"color\"\r\n                className=\"block w-full\"\r\n                value={featureProperties?.[\"marker-color\"] ?? \"#ff0000\"}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n                  updateFeatureProperty(\"marker-color\", e.target.value)\r\n                }\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">Size</label>\r\n              <select\r\n                className=\"w-full px-2 py-1 border rounded\"\r\n                value={featureProperties?.[\"marker-size\"] ?? \"medium\"}\r\n                onChange={(e: ChangeEvent<HTMLSelectElement>) =>\r\n                  updateFeatureProperty(\"marker-size\", e.target.value)\r\n                }\r\n              >\r\n                {markerSizeOptions.map((size) => (\r\n                  <option key={size} value={size}>\r\n                    {size.charAt(0).toUpperCase() + size.slice(1)}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">\r\n                Fill Color\r\n              </label>\r\n              <input\r\n                type=\"color\"\r\n                className=\"block w-full\"\r\n                value={featureProperties?.fill ?? \"#0080ff\"}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n                  updateFeatureProperty(\"fill\", e.target.value)\r\n                }\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">\r\n                Stroke Color\r\n              </label>\r\n              <input\r\n                type=\"color\"\r\n                className=\"block w-full\"\r\n                value={featureProperties?.stroke ?? \"#000000\"}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n                  updateFeatureProperty(\"stroke\", e.target.value)\r\n                }\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">Opacity</label>\r\n              <input\r\n                type=\"range\"\r\n                min=\"0\"\r\n                max=\"1\"\r\n                step=\"0.1\"\r\n                className=\"w-full\"\r\n                value={featureProperties?.[\"fill-opacity\"] ?? 0.5}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n                  updateFeatureProperty(\r\n                    \"fill-opacity\",\r\n                    parseFloat(e.target.value)\r\n                  )\r\n                }\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-1\">\r\n                Stroke Width\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"w-full px-2 py-1 border rounded\"\r\n                min=\"1\"\r\n                max=\"10\"\r\n                value={featureProperties?.strokeWidth ?? 3}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\r\n                  updateFeatureProperty(\"strokeWidth\", parseInt(e.target.value))\r\n                }\r\n              />\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1729, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1735, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/roadSystem.ts"],"sourcesContent":["import { Feature } from \"ol\";\r\nimport GeoJSON from \"ol/format/GeoJSON\";\r\nimport LineString from \"ol/geom/LineString\";\r\nimport { fromLonLat, toLonLat } from \"ol/proj\";\r\nimport { Vector as VectorSource } from \"ol/source\";\r\nimport { Vector as VectorLayer } from \"ol/layer\";\r\nimport { Style, Stroke } from \"ol/style\";\r\nimport { MutableRefObject } from \"react\";\r\nimport Point from \"ol/geom/Point\";\r\nimport { Geometry } from \"ol/geom\";\r\n\r\nexport interface Road {\r\n  id: string;\r\n  name: string;\r\n  type: \"main\" | \"secondary\" | \"path\";\r\n  from: string;\r\n  to: string;\r\n  coordinates: number[][];\r\n}\r\n\r\nexport interface RoadNode {\r\n  id: string;\r\n  name: string;\r\n  isDestination: boolean;\r\n  coordinates: [number, number]; // [longitude, latitude]\r\n  description?: string;\r\n  category?: string;\r\n  imageUrl?: string;\r\n}\r\n\r\n// Setup road system\r\n// Find the closest node to the given coordinates\r\n\r\nexport const findClosestNode = (\r\n  longitude: number,\r\n  latitude: number,\r\n  nodesSource: VectorSource<Feature>\r\n): RoadNode | null => {\r\n  const features = nodesSource.getFeatures();\r\n  if (!features.length) return null;\r\n\r\n  let closestNode: RoadNode | null = null;\r\n  let minDistance = Infinity;\r\n\r\n  features.forEach((feature) => {\r\n    const properties = feature.getProperties();\r\n    const geometry = feature.getGeometry();\r\n    if (!geometry) return;\r\n\r\n    let coordinates: number[] = [0, 0];\r\n\r\n    // Handle different geometry types\r\n    if (geometry instanceof Point) {\r\n      coordinates = geometry.getCoordinates();\r\n    } else {\r\n      // For other geometry types, attempt to get the first coordinate if possible\r\n      try {\r\n        // This is unsafe but we're checking the actual type at runtime\r\n        const coords = (geometry as any).getFirstCoordinate?.();\r\n        if (coords) {\r\n          coordinates = coords;\r\n        } else {\r\n          return; // Skip if we can't get coordinates\r\n        }\r\n      } catch (e) {\r\n        return; // Skip this feature on error\r\n      }\r\n    }\r\n\r\n    // Convert from EPSG:3857 to EPSG:4326\r\n    const geoCoords = toLonLat(coordinates);\r\n\r\n    // Calculate distance (simple Euclidean for now)\r\n    const dx = longitude - geoCoords[0];\r\n    const dy = latitude - geoCoords[1];\r\n    const distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n    if (distance < minDistance) {\r\n      minDistance = distance;\r\n      closestNode = {\r\n        id:\r\n          properties.id || `node-${Math.random().toString(36).substring(2, 9)}`,\r\n        name: properties.name || \"Unnamed Node\",\r\n        isDestination: !!properties.isDestination,\r\n        coordinates: geoCoords as [number, number],\r\n        description: properties.description,\r\n        category: properties.category,\r\n        imageUrl: properties.imageUrl,\r\n      };\r\n    }\r\n  });\r\n\r\n  return closestNode;\r\n};\r\n\r\n// Find the shortest path between two nodes\r\nexport const findShortestPath = (\r\n  startNodeId: string,\r\n  endNodeId: string,\r\n  roadsSource: VectorSource<Feature>,\r\n  nodesSource: VectorSource<Feature>\r\n): Feature[] => {\r\n  // Build a graph from the road network\r\n  const graph: Record<string, Record<string, number>> = {};\r\n  const nodeCoordinates: Record<string, number[]> = {};\r\n\r\n  // Record all node coordinates\r\n  nodesSource.getFeatures().forEach((feature) => {\r\n    const props = feature.getProperties();\r\n    const geometry = feature.getGeometry();\r\n    if (props.id && geometry) {\r\n      let coordinates: number[] = [0, 0];\r\n\r\n      // Handle different geometry types\r\n      if (geometry instanceof Point) {\r\n        coordinates = geometry.getCoordinates();\r\n      } else {\r\n        // Skip if not a point\r\n        return;\r\n      }\r\n\r\n      nodeCoordinates[props.id] = coordinates;\r\n      graph[props.id] = {};\r\n    }\r\n  });\r\n\r\n  nodesSource.on(\"featuresloadend\", () => {\r\n    console.log(\"🚩 roadsystem.txt - featuresloadend triggered\");\r\n    const features = nodesSource.getFeatures();\r\n    console.log(\"🚩 roadsystem.txt - features count:\", features.length);\r\n  });\r\n\r\n  // Add edges to the graph\r\n  roadsSource.getFeatures().forEach((feature) => {\r\n    const props = feature.getProperties();\r\n    if (props.from && props.to) {\r\n      const geometry = feature.getGeometry();\r\n      if (!geometry) return;\r\n\r\n      // Calculate road segment length\r\n      let distance = 0;\r\n      if (geometry instanceof LineString) {\r\n        distance = geometry.getLength();\r\n      } else if (geometry.getType() === \"LineString\") {\r\n        try {\r\n          // Use type assertion for LineString\r\n          const lineString = geometry as LineString;\r\n          distance = lineString.getLength();\r\n        } catch (error) {\r\n          console.error(\"Error calculating line length:\", error);\r\n        }\r\n      }\r\n\r\n      // Add to graph in both directions (assuming bidirectional roads)\r\n      if (!graph[props.from]) graph[props.from] = {};\r\n      if (!graph[props.to]) graph[props.to] = {};\r\n\r\n      graph[props.from][props.to] = distance;\r\n      graph[props.to][props.from] = distance;\r\n    }\r\n\r\n    console.log(\"😊😊Graph structure:\", JSON.stringify(graph));\r\n    console.log(\"Looking for path between:\", startNodeId, \"and\", endNodeId);\r\n    console.log(\"Nodes available:\", Object.keys(graph));\r\n  });\r\n\r\n  // Check if both nodes exist in the graph\r\n  if (!graph[startNodeId] || !graph[endNodeId]) {\r\n    return [];\r\n  }\r\n\r\n  // Dijkstra's algorithm\r\n  const distances: Record<string, number> = {};\r\n  const previous: Record<string, string | null> = {};\r\n  const unvisited = new Set<string>();\r\n\r\n  // Initialize\r\n  Object.keys(graph).forEach((node) => {\r\n    distances[node] = node === startNodeId ? 0 : Infinity;\r\n    previous[node] = null;\r\n    unvisited.add(node);\r\n  });\r\n\r\n  // Main algorithm\r\n  while (unvisited.size > 0) {\r\n    // Find node with minimum distance\r\n    let current: string | null = null;\r\n    let minDistance = Infinity;\r\n\r\n    // Convert Set to Array for iteration to avoid TypeScript error\r\n    Array.from(unvisited).forEach((node) => {\r\n      if (distances[node] < minDistance) {\r\n        minDistance = distances[node];\r\n        current = node;\r\n      }\r\n    });\r\n\r\n    // If we can't find a node or we found the end node\r\n    if (current === null || current === endNodeId) break;\r\n\r\n    // Remove current from unvisited\r\n    unvisited.delete(current);\r\n\r\n    // Check all neighbors\r\n    for (const neighbor in graph[current]) {\r\n      if (!unvisited.has(neighbor)) continue;\r\n\r\n      const distance = distances[current] + graph[current][neighbor];\r\n\r\n      if (distance < distances[neighbor]) {\r\n        distances[neighbor] = distance;\r\n        previous[neighbor] = current;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Build the path\r\n  const path: string[] = [];\r\n  let current = endNodeId;\r\n\r\n  if (previous[endNodeId] === null && startNodeId !== endNodeId) {\r\n    // No path found\r\n    return [];\r\n  }\r\n\r\n  // Construct the path\r\n  while (current) {\r\n    path.unshift(current);\r\n    current = previous[current] || \"\";\r\n    if (current === startNodeId) {\r\n      path.unshift(current);\r\n      break;\r\n    }\r\n    if (!previous[current]) break;\r\n  }\r\n\r\n  // Convert path to features\r\n  const pathFeatures: Feature[] = [];\r\n\r\n  for (let i = 0; i < path.length - 1; i++) {\r\n    const fromNode = path[i];\r\n    const toNode = path[i + 1];\r\n\r\n    // Find the road segment between these nodes\r\n    const roadSegment = roadsSource.getFeatures().find((feature) => {\r\n      const props = feature.getProperties();\r\n      return (\r\n        (props.from === fromNode && props.to === toNode) ||\r\n        (props.from === toNode && props.to === fromNode)\r\n      );\r\n    });\r\n\r\n    if (roadSegment) {\r\n      pathFeatures.push(roadSegment);\r\n    }\r\n  }\r\n\r\n\r\n  return pathFeatures;\r\n};\r\n\r\nexport const setupRoadSystem = (\r\n  roadsUrl: string,\r\n  nodesUrl: string\r\n) => {\r\n  // Create source for roads\r\n  const roadsSource = new VectorSource({\r\n    url: roadsUrl,\r\n    format: new GeoJSON({\r\n      dataProjection: \"EPSG:4326\",\r\n      featureProjection: \"EPSG:3857\",\r\n    }),\r\n  });\r\n\r\n  // Create source for nodes/destinations\r\n  const nodesSource = new VectorSource({\r\n    url: nodesUrl,\r\n    format: new GeoJSON({\r\n      dataProjection: \"EPSG:4326\",\r\n      featureProjection: \"EPSG:3857\",\r\n    }),\r\n  });\r\n\r\n  // Create layer for roads with styling\r\n  const roadsLayer = new VectorLayer({\r\n    source: roadsSource,\r\n    style: (feature) => {\r\n      const properties = feature.getProperties();\r\n      const roadType = properties.type || \"secondary\";\r\n\r\n      // Different styling based on road type\r\n      let color = \"#555555\";\r\n      let width = 3;\r\n      let lineDash: number[] = [];\r\n\r\n      switch (roadType) {\r\n        case \"main\":\r\n          color = \"#333333\";\r\n          width = 5;\r\n          break;\r\n        case \"secondary\":\r\n          color = \"#666666\";\r\n          width = 3;\r\n          break;\r\n        case \"path\":\r\n          color = \"#888888\";\r\n          width = 2;\r\n          lineDash = [4, 4];\r\n          break;\r\n      }\r\n\r\n      return new Style({\r\n        stroke: new Stroke({\r\n          color: color,\r\n          width: width,\r\n          lineDash: lineDash,\r\n        }),\r\n      });\r\n    },\r\n    zIndex: 5, // Place below points but above polygon areas\r\n  });\r\n\r\n  // Load initial roads data\r\n  roadsSource.on(\"featuresloadend\", () => {\r\n    const features = roadsSource.getFeatures();\r\n  });\r\n\r\n  // Handle potential errors loading roads\r\n  roadsSource.on(\"featuresloaderror\", (error: any) => {\r\n  });\r\n\r\n  // Load initial nodes data\r\n  nodesSource.on(\"featuresloadend\", () => {\r\n    const features = nodesSource.getFeatures();\r\n\r\n    // Count destinations for debugging\r\n    const destinations = features.filter((feature) => {\r\n      const props = feature.getProperties();\r\n      return props.isDestination === true;\r\n    });\r\n    console.log(\r\n      `✅ featuresloadend in road system triggered ${features}, total features: ${features.length}`\r\n    );\r\n\r\n    console.log(\r\n      `✅ featuresloadend in road system triggered, total features: ${destinations}`\r\n    );\r\n\r\n\r\n  });\r\n\r\n  // Handle potential errors loading nodes\r\n  nodesSource.on(\"featuresloaderror\", (error: any) => {\r\n  });\r\n\r\n  return { roadsLayer, roadsSource, nodesSource };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2021, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2027, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/qrCodeUtils.ts"],"sourcesContent":["import QRCode from \"qrcode\";\r\nimport { MutableRefObject, useCallback, useRef, useState } from \"react\";\r\nimport { RoadNode } from \"./roadSystem\";\r\n\r\n// =============================================\r\n// Interface Definitions\r\n// =============================================\r\n\r\nexport interface RouteData {\r\n  startNodeId: string;\r\n  endNodeId: string;\r\n  routeInfo?: {\r\n    distance: number;\r\n    estimatedTime: number;\r\n    description?: string;\r\n  };\r\n  timestamp?: number;\r\n  metadata?: {\r\n    creator?: string;\r\n    campusId?: string;\r\n  };\r\n}\r\n\r\nexport interface QRCodeOptions {\r\n  primaryColor?: string;\r\n  secondaryColor?: string;\r\n  logoUrl?: string;\r\n  cornerRadius?: number;\r\n  borderSize?: number;\r\n  errorCorrection?: \"L\" | \"M\" | \"Q\" | \"H\";\r\n}\r\n\r\n// =============================================\r\n// Styling Helper Functions\r\n// =============================================\r\n\r\n// Helper function for rounded rectangles\r\nfunction roundedRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  radius: number\r\n) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + radius, y);\r\n  ctx.lineTo(x + width - radius, y);\r\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n  ctx.lineTo(x + width, y + height - radius);\r\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n  ctx.lineTo(x + radius, y + height);\r\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n  ctx.lineTo(x, y + radius);\r\n  ctx.quadraticCurveTo(x, y, x + radius, y);\r\n  ctx.closePath();\r\n}\r\n\r\n// =============================================\r\n// QR Code Generation\r\n// =============================================\r\n\r\nexport const generateRouteQR = async (\r\n  routeData: RouteData,\r\n  options: QRCodeOptions = {},\r\n): Promise<string> => {\r\n  try {\r\n    // Add timestamp to ensure QR code is unique\r\n    const dataWithTimestamp = {\r\n      ...routeData,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Get base URL - default to window.location.origin\r\n    let baseUrl = window.location.origin;\r\n\r\n    // Check if we're running in a kiosk and have an ngrok URL available\r\n    if (window.electron?.isElectron) {\r\n      try {\r\n        const ngrokUrl = await window.electron.getNgrokUrl();\r\n        if (ngrokUrl) {\r\n          baseUrl = ngrokUrl;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error getting ngrok URL:\", error);\r\n      }\r\n    }\r\n\r\n    // Build the route URL with parameters\r\n    const params = new URLSearchParams();\r\n    params.set(\"startNode\", routeData.startNodeId);\r\n    params.set(\"endNode\", routeData.endNodeId);\r\n\r\n    if (routeData.routeInfo) {\r\n      params.set(\"distance\", routeData.routeInfo.distance.toString());\r\n      params.set(\"time\", routeData.routeInfo.estimatedTime.toString());\r\n\r\n      if (routeData.routeInfo.description) {\r\n        params.set(\"desc\", routeData.routeInfo.description);\r\n      }\r\n    }\r\n\r\n    // Add metadata if available\r\n    if (routeData.metadata?.campusId) {\r\n      params.set(\"campus\", routeData.metadata.campusId);\r\n    }\r\n\r\n    const fullUrl = `${baseUrl}/route?${params.toString()}`;\r\n\r\n    // Set QR code options with defaults\r\n    const {\r\n      primaryColor = \"#4285F4\",\r\n      secondaryColor = \"#34A853\",\r\n      errorCorrection = \"H\",\r\n      cornerRadius = 10,\r\n      borderSize = 2,\r\n      logoUrl = null,\r\n    } = options;\r\n\r\n    // First, generate basic QR code as data URL\r\n    const qrCodeDataUrl = await QRCode.toDataURL(fullUrl, {\r\n      errorCorrectionLevel: errorCorrection,\r\n      margin: borderSize,\r\n      width: 400,\r\n      color: {\r\n        dark: primaryColor,\r\n        light: \"#ffffff\",\r\n      },\r\n    });\r\n\r\n    // If we don't need to add styling, return the basic QR code\r\n    if (!cornerRadius && !logoUrl) {\r\n      return qrCodeDataUrl;\r\n    }\r\n\r\n    // For advanced styling, use canvas\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const canvas = document.createElement(\"canvas\");\r\n        const size = 400;\r\n        canvas.width = size;\r\n        canvas.height = size;\r\n        const ctx = canvas.getContext(\"2d\");\r\n\r\n        if (!ctx) {\r\n          resolve(qrCodeDataUrl);\r\n          return;\r\n        }\r\n\r\n        const image = new Image();\r\n        image.onload = () => {\r\n          // Draw gradient background\r\n          const gradient = ctx.createLinearGradient(0, 0, size, size);\r\n          gradient.addColorStop(0, primaryColor);\r\n          gradient.addColorStop(1, secondaryColor || primaryColor);\r\n\r\n          // Fill background with gradient if cornerRadius > 0, otherwise white\r\n          if (cornerRadius > 0) {\r\n            ctx.fillStyle = \"#ffffff\";\r\n            ctx.fillRect(0, 0, size, size);\r\n\r\n            ctx.save();\r\n            roundedRect(ctx, 0, 0, size, size, cornerRadius);\r\n            ctx.clip();\r\n            ctx.fillStyle = gradient;\r\n            ctx.fillRect(0, 0, size, size);\r\n\r\n            // Draw white background for QR code\r\n            ctx.fillStyle = \"#ffffff\";\r\n            roundedRect(ctx, 10, 10, size - 20, size - 20, cornerRadius - 5);\r\n            ctx.fill();\r\n\r\n            // Draw QR code\r\n            ctx.drawImage(image, 10, 10, size - 20, size - 20);\r\n            ctx.restore();\r\n          } else {\r\n            ctx.fillStyle = \"#ffffff\";\r\n            ctx.fillRect(0, 0, size, size);\r\n            ctx.drawImage(image, 0, 0, size, size);\r\n          }\r\n\r\n          // Add logo if specified\r\n          if (logoUrl) {\r\n            const logo = new Image();\r\n            logo.onload = () => {\r\n              // Calculate logo size (25% of QR code)\r\n              const logoSize = size * 0.25;\r\n              const logoX = (size - logoSize) / 2;\r\n              const logoY = (size - logoSize) / 2;\r\n\r\n              // Create rounded white background for logo\r\n              ctx.save();\r\n              ctx.fillStyle = \"#ffffff\";\r\n              roundedRect(\r\n                ctx,\r\n                logoX - 10,\r\n                logoY - 10,\r\n                logoSize + 20,\r\n                logoSize + 20,\r\n                12\r\n              );\r\n              ctx.fill();\r\n\r\n              // Add shadow\r\n              ctx.shadowColor = \"rgba(0, 0, 0, 0.2)\";\r\n              ctx.shadowBlur = 10;\r\n              ctx.shadowOffsetX = 0;\r\n              ctx.shadowOffsetY = 0;\r\n\r\n              // Draw logo\r\n              ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);\r\n              ctx.restore();\r\n\r\n              // Convert to data URL and resolve promise\r\n              resolve(canvas.toDataURL(\"image/png\"));\r\n            };\r\n\r\n            logo.onerror = () => {\r\n              // If logo fails to load, return the styled QR code without logo\r\n              resolve(canvas.toDataURL(\"image/png\"));\r\n            };\r\n\r\n            logo.src = logoUrl;\r\n          } else {\r\n            // No logo, just return the styled QR code\r\n            resolve(canvas.toDataURL(\"image/png\"));\r\n          }\r\n        };\r\n\r\n        image.onerror = () => {\r\n          // If QR code image fails to load, return the original data URL\r\n          resolve(qrCodeDataUrl);\r\n        };\r\n\r\n        image.src = qrCodeDataUrl;\r\n      } catch (error) {\r\n        console.error(\"Error applying QR styling:\", error);\r\n        // If any error occurs during styling, return the basic QR code\r\n        resolve(qrCodeDataUrl);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error generating QR code:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// =============================================\r\n// Route Data Parsing\r\n// =============================================\r\n\r\n// Parse route data from URL parameters\r\nexport const parseRouteFromUrl = (\r\n  urlParams: URLSearchParams,\r\n): RouteData | null => {\r\n  try {\r\n    const startNodeId = urlParams.get(\"startNode\");\r\n    const endNodeId = urlParams.get(\"endNode\");\r\n\r\n    if (!startNodeId || !endNodeId) {\r\n      console.warn(\"Missing required route parameters in URL\");\r\n      return null;\r\n    }\r\n\r\n    const routeData: RouteData = {\r\n      startNodeId,\r\n      endNodeId,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Parse optional route info\r\n    const distance = urlParams.get(\"distance\");\r\n    const time = urlParams.get(\"time\");\r\n    const desc = urlParams.get(\"desc\");\r\n    const campus = urlParams.get(\"campus\");\r\n\r\n    if (distance && time) {\r\n      routeData.routeInfo = {\r\n        distance: parseFloat(distance),\r\n        estimatedTime: parseFloat(time),\r\n        description: desc || undefined,\r\n      };\r\n    }\r\n\r\n    if (campus) {\r\n      routeData.metadata = {\r\n        ...routeData.metadata,\r\n        campusId: campus,\r\n      };\r\n    }\r\n\r\n    return routeData;\r\n  } catch (error) {\r\n    console.error(\"Error parsing route data from URL:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// =============================================\r\n// Kiosk Route Management\r\n// =============================================\r\n\r\n// This merged hook combines QR generation with kiosk state management\r\nexport const useKioskRouteManager = (options: {\r\n  currentLocation: RoadNode | null;\r\n  selectedDestination: RoadNode | null;\r\n  routeInfo?: {\r\n    distance: number;\r\n    estimatedTime: number;\r\n  };\r\n  defaultStartLocation: RoadNode | null;\r\n  onReset?: () => void;\r\n}) => {\r\n  const {\r\n    currentLocation,\r\n    selectedDestination,\r\n    routeInfo,\r\n    defaultStartLocation,\r\n    onReset,\r\n  } = options;\r\n\r\n  const [qrCodeUrl, setQRCodeUrl] = useState<string>(\"\");\r\n  const [showQRModal, setShowQRModal] = useState<boolean>(false);\r\n  const [isGenerating, setIsGenerating] = useState<boolean>(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const resetTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isProcessingRef = useRef<boolean>(false);\r\n\r\n  // Function to reset the kiosk state\r\n  const resetKiosk = useCallback(() => {\r\n    setShowQRModal(false);\r\n    setQRCodeUrl(\"\");\r\n    setError(null);\r\n\r\n    if (resetTimeoutRef.current) {\r\n      clearTimeout(resetTimeoutRef.current);\r\n      resetTimeoutRef.current = null;\r\n    }\r\n\r\n    if (onReset) {\r\n      onReset();\r\n    }\r\n  }, [onReset]);\r\n\r\n  // Function to generate QR code for current route\r\n  const generateRouteQRCode = useCallback(async () => {\r\n    // Prevent multiple simultaneous generations\r\n    if (isProcessingRef.current) {\r\n      console.warn(\"Already generating QR code, please wait\");\r\n      return;\r\n    }\r\n\r\n    // Clear any previous error\r\n    setError(null);\r\n\r\n    // Set processing flag\r\n    isProcessingRef.current = true;\r\n    setIsGenerating(true);\r\n\r\n    try {\r\n      const startNodeId = currentLocation\r\n        ? currentLocation.id\r\n        : defaultStartLocation\r\n          ? defaultStartLocation.id\r\n          : null;\r\n\r\n      if (!startNodeId || !selectedDestination) {\r\n        throw new Error(\"Missing start location or destination\");\r\n      }\r\n\r\n      if (!routeInfo) {\r\n        throw new Error(\"Missing route information\");\r\n      }\r\n\r\n      // Create route data object\r\n      const routeData: RouteData = {\r\n        startNodeId,\r\n        endNodeId: selectedDestination.id,\r\n        routeInfo: {\r\n          distance: routeInfo.distance,\r\n          estimatedTime: routeInfo.estimatedTime,\r\n        },\r\n        timestamp: Date.now(),\r\n      };\r\n\r\n      // Generate QR code\r\n      const qrCode = await generateRouteQR(routeData, {\r\n        primaryColor: \"#4285F4\",\r\n        secondaryColor: \"#34A853\",\r\n        cornerRadius: 10,\r\n        errorCorrection: \"H\",\r\n      });\r\n\r\n      // Update state with generated QR code\r\n      setQRCodeUrl(qrCode);\r\n      setShowQRModal(true);\r\n    } catch (error) {\r\n      // Handle errors\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : String(error);\r\n\r\n      setError(errorMessage);\r\n    } finally {\r\n      // Reset processing flag\r\n      isProcessingRef.current = false;\r\n      setIsGenerating(false);\r\n    }\r\n  }, [\r\n    currentLocation,\r\n    selectedDestination,\r\n    routeInfo,\r\n    defaultStartLocation,\r\n  ]);\r\n\r\n  // Handle closing the QR modal\r\n  const closeQRModal = useCallback(() => {\r\n    resetKiosk();\r\n  }, [resetKiosk]);\r\n\r\n  return {\r\n    qrCodeUrl,\r\n    showQRModal,\r\n    isGenerating,\r\n    error,\r\n    generateRouteQRCode,\r\n    closeQRModal,\r\n    resetKiosk,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2337, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2343, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/DestinationSelector.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from \"react\";\r\nimport { RoadNode } from \"./roadSystem\";\r\n\r\ninterface DestinationSelectorProps {\r\n  destinations: RoadNode[];\r\n  onSelect: (destination: RoadNode) => void;\r\n  onClose: () => void;\r\n  categories?: string[];\r\n}\r\n\r\ninterface CategoryGroupProps {\r\n  category: string;\r\n  destinations: RoadNode[];\r\n  onSelect: (destination: RoadNode) => void;\r\n}\r\n\r\n// CategoryGroup component wrapped in React.memo for performance\r\nconst CategoryGroup: React.FC<CategoryGroupProps> = React.memo(\r\n  ({ category, destinations, onSelect }) => {\r\n    const [expanded, setExpanded] = useState(true);\r\n\r\n    // Skip rendering empty categories\r\n    if (destinations.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    // Memoize the toggle function\r\n    const toggleExpanded = useCallback(() => {\r\n      setExpanded((prev) => !prev);\r\n    }, []);\r\n\r\n    return (\r\n      <div className=\"mb-4\">\r\n        <div\r\n          className=\"flex items-center justify-between bg-gray-100 p-2 rounded-t cursor-pointer\"\r\n          onClick={toggleExpanded}\r\n        >\r\n          <h3 className=\"font-medium\">\r\n            {category} ({destinations.length})\r\n          </h3>\r\n          <span>{expanded ? \"▼\" : \"►\"}</span>\r\n        </div>\r\n\r\n        {expanded && (\r\n          <div className=\"pl-2 border-l-2 border-gray-200\">\r\n            {destinations.map((destination) => (\r\n              <div\r\n                key={destination.id}\r\n                className=\"p-2 hover:bg-gray-50 cursor-pointer flex items-center\"\r\n                onClick={() => onSelect(destination)}\r\n              >\r\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></div>\r\n                <span>{destination.name}</span>\r\n                {destination.description && (\r\n                  <span className=\"ml-1 text-xs text-gray-500\">\r\n                    {\" \"}\r\n                    - {destination.description.substring(0, 30)}\r\n                    {destination.description.length > 30 ? \"...\" : \"\"}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\n// Set display name for React DevTools\r\nCategoryGroup.displayName = \"CategoryGroup\";\r\n\r\nconst DestinationSelector: React.FC<DestinationSelectorProps> = ({\r\n  destinations,\r\n  onSelect,\r\n  onClose,\r\n  categories = [],\r\n}) => {\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [filteredDestinations, setFilteredDestinations] =\r\n    useState<RoadNode[]>(destinations);\r\n\r\n  // Memoize the search handler to prevent recreating it on every render\r\n  const handleSearchChange = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      setSearchQuery(e.target.value);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Filter destinations based on search query - memoized\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredDestinations(destinations);\r\n\r\n      return;\r\n    }\r\n\r\n    const query = searchQuery.toLowerCase().trim();\r\n    const filtered = destinations.filter(\r\n      (dest) =>\r\n        dest.name.toLowerCase().includes(query) ||\r\n        (dest.description && dest.description.toLowerCase().includes(query)) ||\r\n        (dest.category && dest.category.toLowerCase().includes(query))\r\n    );\r\n\r\n    setFilteredDestinations(filtered);\r\n  }, [searchQuery, destinations]);\r\n\r\n  // Make sure we have the latest destinations\r\n  useEffect(() => {\r\n    setFilteredDestinations(destinations);\r\n  }, [destinations]);\r\n\r\n  // Memoize the used categories\r\n  const usedCategories = useMemo(() => {\r\n    return categories.length > 0\r\n      ? categories\r\n      : Array.from(new Set(destinations.map((d) => d.category || \"Other\")));\r\n  }, [categories, destinations]);\r\n\r\n  // Memoize the destinations grouped by category\r\n  const destinationsByCategory = useMemo(() => {\r\n    const result: Record<string, RoadNode[]> = {};\r\n\r\n    // Initialize empty arrays for each category\r\n    usedCategories.forEach((category) => {\r\n      result[category] = [];\r\n    });\r\n\r\n    // Fill with filtered destinations\r\n    filteredDestinations.forEach((dest) => {\r\n      const category = dest.category || \"Other\";\r\n      if (!result[category]) {\r\n        result[category] = [];\r\n      }\r\n      result[category].push(dest);\r\n    });\r\n\r\n    return result;\r\n  }, [filteredDestinations, usedCategories]);\r\n\r\n  // Memoize the empty state component\r\n  const EmptyState = useMemo(() => {\r\n    if (destinations.length === 0) {\r\n      return (\r\n        <div className=\"text-center py-4 bg-yellow-100 rounded-lg\">\r\n          <p className=\"font-medium text-yellow-800\">No destinations loaded</p>\r\n          <p className=\"text-sm text-yellow-700 mt-1\">\r\n            Please check your data files or refresh the page.\r\n          </p>\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [destinations.length]);\r\n\r\n  // Memoize the no results component\r\n  const NoResults = useMemo(() => {\r\n    if (\r\n      filteredDestinations.length === 0 &&\r\n      destinations.length > 0 &&\r\n      searchQuery.trim() !== \"\"\r\n    ) {\r\n      return (\r\n        <div className=\"text-center text-gray-500 py-4\">\r\n          No destinations found for \"{searchQuery}\"\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [filteredDestinations.length, destinations.length, searchQuery]);\r\n\r\n  // Memoize the category groups\r\n  const CategoryGroups = useMemo(() => {\r\n    return Object.entries(destinationsByCategory).map(([category, dests]) => {\r\n      if (dests.length === 0) return null;\r\n\r\n      return (\r\n        <CategoryGroup\r\n          key={category}\r\n          category={category}\r\n          destinations={dests}\r\n          onSelect={onSelect}\r\n        />\r\n      );\r\n    });\r\n  }, [destinationsByCategory, onSelect]);\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-lg p-4 w-80 max-h-[70vh] overflow-y-auto\">\r\n      <div className=\"flex justify-between items-center mb-4\">\r\n        <h2 className=\"text-lg font-bold\">Select Destination</h2>\r\n        <button className=\"text-gray-500 hover:text-gray-700\" onClick={onClose}>\r\n          ✕\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"mb-4\">\r\n        <input\r\n          type=\"text\"\r\n          className=\"w-full px-3 py-2 border rounded-md\"\r\n          placeholder=\"Search destinations...\"\r\n          value={searchQuery}\r\n          onChange={handleSearchChange}\r\n        />\r\n      </div>\r\n\r\n      {EmptyState || (\r\n        <div>\r\n          {CategoryGroups}\r\n          {NoResults}\r\n        </div>\r\n      )}\r\n\r\n      {/* Debug info */}\r\n      <div className=\"mt-3 pt-2 border-t text-xs text-gray-500\">\r\n        <p>Total destinations: {destinations.length}</p>\r\n        <p>Filtered destinations: {filteredDestinations.length}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Export the component wrapped in React.memo for performance optimization\r\nexport default React.memo(DestinationSelector);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2710, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2716, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/KioskQRModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { RoadNode } from \"./roadSystem\";\r\n\r\ninterface KioskQRModalProps {\r\n  qrCodeUrl: string;\r\n  destination: RoadNode;\r\n  routeInfo?: {\r\n    distance: number;\r\n    estimatedTime: number;\r\n  };\r\n  onClose: () => void;\r\n  autoCloseTime?: number;\r\n}\r\n\r\nconst KioskQRModal: React.FC<KioskQRModalProps> = ({\r\n  qrCodeUrl,\r\n  destination,\r\n  routeInfo,\r\n  onClose,\r\n  autoCloseTime = 60,\r\n}) => {\r\n  const [countdown, setCountdown] = useState<number>(autoCloseTime);\r\n  const [isScanning, setIsScanning] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      setCountdown((prev) => {\r\n        if (prev <= 1) {\r\n          clearInterval(timer);\r\n          onClose();\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [onClose, autoCloseTime]);\r\n\r\n  const formattedDistance = useMemo(() => {\r\n    if (!routeInfo) return \"Unknown\";\r\n    return routeInfo.distance < 1000\r\n      ? `${Math.round(routeInfo.distance)}m`\r\n      : `${(routeInfo.distance / 1000).toFixed(2)}km`;\r\n  }, [routeInfo]);\r\n\r\n  const formattedTime = useMemo(() => {\r\n    if (!routeInfo) return \"Unknown\";\r\n    const minutes = Math.ceil(routeInfo.estimatedTime);\r\n    return minutes === 1 ? \"1 min\" : `${minutes} mins`;\r\n  }, [routeInfo]);\r\n\r\n  const calories = useMemo(() => {\r\n    if (!routeInfo) return 0;\r\n    return Math.round((routeInfo.distance / 1000) * 65);\r\n  }, [routeInfo]);\r\n\r\n  const progressPercent = ((autoCloseTime - countdown) / autoCloseTime) * 100;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        className=\"fixed inset-0 flex items-center justify-center z-50 bg-black/60 backdrop-blur-md\"\r\n        onClick={(e) => e.target === e.currentTarget && onClose()}\r\n      >\r\n        <motion.div\r\n          initial={{ scale: 0.9, opacity: 0, y: 20 }}\r\n          animate={{ scale: 1, opacity: 1, y: 0 }}\r\n          exit={{ scale: 0.9, opacity: 0, y: 20 }}\r\n          transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\r\n          className=\"max-w-4xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden mx-4 relative\"\r\n        >\r\n          {/* Progress Bar */}\r\n          <div className=\"absolute top-0 left-0 right-0 h-1 bg-gray-200\">\r\n            <motion.div\r\n              className=\"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500\"\r\n              initial={{ width: 0 }}\r\n              animate={{ width: `${progressPercent}%` }}\r\n              transition={{ duration: 0.5 }}\r\n            />\r\n          </div>\r\n\r\n          {/* Header */}\r\n          <div className=\"bg-gradient-to-br from-blue-600 via-blue-700 to-purple-600 p-6 relative overflow-hidden\">\r\n            <div className=\"absolute inset-0 opacity-10\">\r\n              <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIvPjwvc3ZnPg==')]\"></div>\r\n            </div>\r\n\r\n            <div className=\"relative z-10\">\r\n              <div className=\"flex justify-between items-start mb-3\">\r\n                <div className=\"flex-1\">\r\n                  <motion.h2\r\n                    initial={{ x: -20, opacity: 0 }}\r\n                    animate={{ x: 0, opacity: 1 }}\r\n                    transition={{ delay: 0.1 }}\r\n                    className=\"text-3xl font-bold text-white mb-2\"\r\n                  >\r\n                    Navigate to {destination.name}\r\n                  </motion.h2>\r\n                  {destination.category && (\r\n                    <motion.div\r\n                      initial={{ x: -20, opacity: 0 }}\r\n                      animate={{ x: 0, opacity: 1 }}\r\n                      transition={{ delay: 0.2 }}\r\n                      className=\"inline-flex items-center px-4 py-1.5 bg-white/20 backdrop-blur-sm rounded-full text-white text-sm font-medium\"\r\n                    >\r\n                      <span className=\"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse\"></span>\r\n                      {destination.category}\r\n                    </motion.div>\r\n                  )}\r\n                </div>\r\n\r\n                <motion.div\r\n                  initial={{ scale: 0 }}\r\n                  animate={{ scale: 1 }}\r\n                  transition={{ delay: 0.3, type: \"spring\" }}\r\n                  className=\"flex flex-col items-end\"\r\n                >\r\n                  <div className=\"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-xl text-white font-semibold mb-2\">\r\n                    <div className=\"text-2xl\">{countdown}s</div>\r\n                    <div className=\"text-xs opacity-80\">Auto-closing</div>\r\n                  </div>\r\n                </motion.div>\r\n              </div>\r\n\r\n              {destination.description && (\r\n                <motion.p\r\n                  initial={{ y: 10, opacity: 0 }}\r\n                  animate={{ y: 0, opacity: 1 }}\r\n                  transition={{ delay: 0.3 }}\r\n                  className=\"text-white/90 text-sm max-w-2xl\"\r\n                >\r\n                  {destination.description}\r\n                </motion.p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main Content */}\r\n          <div className=\"p-8\">\r\n            <div className=\"grid md:grid-cols-2 gap-8 items-center\">\r\n              {/* QR Code Section */}\r\n              <motion.div\r\n                initial={{ x: -30, opacity: 0 }}\r\n                animate={{ x: 0, opacity: 1 }}\r\n                transition={{ delay: 0.4 }}\r\n                className=\"relative\"\r\n              >\r\n                <div className=\"relative group\">\r\n                  {/* Animated border */}\r\n                  <div className=\"absolute -inset-4 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-3xl blur-xl opacity-30 group-hover:opacity-50 transition-opacity\"></div>\r\n\r\n                  {/* QR Code Container */}\r\n                  <div className=\"relative bg-white p-6 rounded-2xl shadow-xl\">\r\n                    <motion.img\r\n                      src={qrCodeUrl}\r\n                      alt=\"Route QR Code\"\r\n                      className=\"w-full h-auto object-contain\"\r\n                      whileHover={{ scale: 1.05 }}\r\n                      transition={{ type: \"spring\", stiffness: 300 }}\r\n                      onMouseEnter={() => setIsScanning(true)}\r\n                      onMouseLeave={() => setIsScanning(false)}\r\n                    />\r\n\r\n                    {/* Scanning animation */}\r\n                    <AnimatePresence>\r\n                      {isScanning && (\r\n                        <motion.div\r\n                          initial={{ top: 0, opacity: 0 }}\r\n                          animate={{ top: \"100%\", opacity: [0, 1, 0] }}\r\n                          exit={{ opacity: 0 }}\r\n                          transition={{ duration: 2, repeat: Infinity }}\r\n                          className=\"absolute left-0 right-0 h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent\"\r\n                        />\r\n                      )}\r\n                    </AnimatePresence>\r\n                  </div>\r\n\r\n                  {/* Corner accents */}\r\n                  <div className=\"absolute -top-2 -left-2 w-8 h-8 border-t-4 border-l-4 border-blue-500 rounded-tl-2xl\"></div>\r\n                  <div className=\"absolute -top-2 -right-2 w-8 h-8 border-t-4 border-r-4 border-purple-500 rounded-tr-2xl\"></div>\r\n                  <div className=\"absolute -bottom-2 -left-2 w-8 h-8 border-b-4 border-l-4 border-purple-500 rounded-bl-2xl\"></div>\r\n                  <div className=\"absolute -bottom-2 -right-2 w-8 h-8 border-b-4 border-r-4 border-pink-500 rounded-br-2xl\"></div>\r\n                </div>\r\n\r\n                <motion.div\r\n                  initial={{ y: 10, opacity: 0 }}\r\n                  animate={{ y: 0, opacity: 1 }}\r\n                  transition={{ delay: 0.6 }}\r\n                  className=\"mt-4 text-center bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-3\"\r\n                >\r\n                  <p className=\"text-sm font-medium text-gray-700\">\r\n                    📱 Position your camera over the QR code\r\n                  </p>\r\n                </motion.div>\r\n              </motion.div>\r\n\r\n              {/* Instructions Section */}\r\n              <motion.div\r\n                initial={{ x: 30, opacity: 0 }}\r\n                animate={{ x: 0, opacity: 1 }}\r\n                transition={{ delay: 0.4 }}\r\n              >\r\n                <h3 className=\"text-2xl font-bold text-gray-800 mb-4 flex items-center\">\r\n                  <span className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center text-white mr-3\">\r\n                    <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\r\n                    </svg>\r\n                  </span>\r\n                  Quick Start Guide\r\n                </h3>\r\n\r\n                <div className=\"space-y-3\">\r\n                  {[\r\n                    { icon: \"📱\", title: \"Open Camera\", desc: \"Launch your phone's camera app\" },\r\n                    { icon: \"🎯\", title: \"Point & Scan\", desc: \"Aim at the QR code above\" },\r\n                    { icon: \"🔔\", title: \"Tap Notification\", desc: \"Click the banner that appears\" },\r\n                    { icon: \"🗺️\", title: \"Navigate\", desc: \"Follow live directions on your phone\" }\r\n                  ].map((step, index) => (\r\n                    <motion.div\r\n                      key={index}\r\n                      initial={{ x: 20, opacity: 0 }}\r\n                      animate={{ x: 0, opacity: 1 }}\r\n                      transition={{ delay: 0.5 + index * 0.1 }}\r\n                      className=\"flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:shadow-md transition-shadow group\"\r\n                    >\r\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center text-2xl mr-4 group-hover:scale-110 transition-transform\">\r\n                        {step.icon}\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"font-semibold text-gray-800\">{step.title}</p>\r\n                        <p className=\"text-sm text-gray-600\">{step.desc}</p>\r\n                      </div>\r\n                      <div className=\"w-8 h-8 bg-white rounded-full flex items-center justify-center text-blue-600 font-bold shadow-sm\">\r\n                        {index + 1}\r\n                      </div>\r\n                    </motion.div>\r\n                  ))}\r\n                </div>\r\n\r\n                <motion.div\r\n                  initial={{ y: 10, opacity: 0 }}\r\n                  animate={{ y: 0, opacity: 1 }}\r\n                  transition={{ delay: 0.9 }}\r\n                  className=\"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl\"\r\n                >\r\n                  <p className=\"text-sm text-amber-800 flex items-center\">\r\n                    <svg className=\"w-5 h-5 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                    <strong>Don't forget your phone!</strong> Keep it with you during navigation.\r\n                  </p>\r\n                </motion.div>\r\n              </motion.div>\r\n            </div>\r\n\r\n            {/* Route Statistics */}\r\n            {routeInfo && (\r\n              <motion.div\r\n                initial={{ y: 20, opacity: 0 }}\r\n                animate={{ y: 0, opacity: 1 }}\r\n                transition={{ delay: 0.7 }}\r\n                className=\"mt-8 grid grid-cols-3 gap-4\"\r\n              >\r\n                {[\r\n                  { label: \"Distance\", value: formattedDistance, icon: \"🏃\", color: \"from-blue-500 to-blue-600\" },\r\n                  { label: \"Walking Time\", value: formattedTime, icon: \"⏱️\", color: \"from-purple-500 to-purple-600\" },\r\n                  { label: \"Calories\", value: `${calories} cal`, icon: \"🔥\", color: \"from-pink-500 to-pink-600\" }\r\n                ].map((stat, index) => (\r\n                  <motion.div\r\n                    key={index}\r\n                    whileHover={{ scale: 1.05, y: -5 }}\r\n                    className={`bg-gradient-to-br ${stat.color} p-5 rounded-2xl text-white shadow-lg relative overflow-hidden group`}\r\n                  >\r\n                    <div className=\"absolute inset-0 bg-white/0 group-hover:bg-white/10 transition-colors\"></div>\r\n                    <div className=\"relative z-10\">\r\n                      <div className=\"text-3xl mb-2\">{stat.icon}</div>\r\n                      <div className=\"text-xs opacity-90 mb-1\">{stat.label}</div>\r\n                      <div className=\"text-2xl font-bold\">{stat.value}</div>\r\n                    </div>\r\n                  </motion.div>\r\n                ))}\r\n              </motion.div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-5 flex justify-between items-center border-t border-gray-200\">\r\n            <motion.p\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              transition={{ delay: 0.8 }}\r\n              className=\"text-sm text-gray-600 italic\"\r\n            >\r\n              🔄 Map resets automatically for the next user\r\n            </motion.p>\r\n\r\n            <motion.button\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              onClick={onClose}\r\n              className=\"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-shadow\"\r\n            >\r\n              Close ({countdown}s)\r\n            </motion.button>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default React.memo(KioskQRModal);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3530, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3536, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/RouteOverlay.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { RoadNode } from \"./roadSystem\";\r\n\r\ninterface RouteOverlayProps {\r\n  startNode: RoadNode | null;\r\n  endNode: RoadNode | null;\r\n  routeInfo?: {\r\n    distance: number;\r\n    estimatedTime: number;\r\n  };\r\n  onCancel: () => void;\r\n  onGenerateQR: () => void;\r\n  isLoading?: boolean;\r\n}\r\n\r\nconst RouteOverlay: React.FC<RouteOverlayProps> = ({\r\n  startNode,\r\n  endNode,\r\n  routeInfo,\r\n  onCancel,\r\n  onGenerateQR,\r\n  isLoading = false,\r\n}) => {\r\n  if (!startNode || !endNode) return null;\r\n\r\n  return (\r\n    <div className=\"absolute bottom-4 left-4 right-4 mx-auto w-80 bg-white bg-opacity-95 p-4 rounded-lg shadow-lg z-30\">\r\n      <div className=\"flex space-x-2\">\r\n        <button\r\n          className=\"flex-1 py-2.5 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\r\n          onClick={onGenerateQR}\r\n          disabled={isLoading}\r\n        >\r\n          {isLoading ? (\r\n            <>\r\n              <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"></div>\r\n              Generating...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                className=\"h-5 w-5 mr-1.5\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n                stroke=\"currentColor\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"\r\n                />\r\n              </svg>\r\n              Generate QR\r\n            </>\r\n          )}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RouteOverlay;\r\n"],"names":[],"mappings":";;;;;AAeA,MAAM,eAA4C,CAAC,EACjD,SAAS,EACT,OAAO,EACP,SAAS,EACT,QAAQ,EACR,YAAY,EACZ,YAAY,KAAK,EAClB;IACC,IAAI,CAAC,aAAa,CAAC,SAAS,OAAO;IAEnC,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBACC,WAAU;gBACV,SAAS;gBACT,UAAU;0BAET,0BACC;;sCACE,6LAAC;4BAAI,WAAU;;;;;;wBAA0F;;iDAI3G;;sCACE,6LAAC;4BACC,OAAM;4BACN,WAAU;4BACV,MAAK;4BACL,SAAQ;4BACR,QAAO;sCAEP,cAAA,6LAAC;gCACC,eAAc;gCACd,gBAAe;gCACf,aAAa;gCACb,GAAE;;;;;;;;;;;wBAEA;;;;;;;;;;;;;;;;;;AAQpB;KA9CM;uCAgDS"}},
    {"offset": {"line": 3611, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3617, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/EnhancedMobileRoutePanel.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { motion, AnimatePresence, PanInfo } from \"framer-motion\";\r\nimport { RoadNode } from \"./roadSystem\";\r\nimport { RouteProgress } from \"./enhancedLocationTracking\";\r\n\r\ninterface EnhancedMobileRoutePanelProps {\r\n  destination: RoadNode;\r\n  currentLocation: RoadNode | null;\r\n  routeInfo?: {\r\n    distance: number;\r\n    estimatedTime: number;\r\n  };\r\n  routeProgress?: RouteProgress | null;\r\n  onClose?: () => void;\r\n}\r\n\r\nconst EnhancedMobileRoutePanel: React.FC<EnhancedMobileRoutePanelProps> = ({\r\n  destination,\r\n  currentLocation,\r\n  routeInfo,\r\n  routeProgress,\r\n  onClose,\r\n}) => {\r\n  const [showDirections, setShowDirections] = useState(false);\r\n  const [isPanelExpanded, setIsPanelExpanded] = useState(false);\r\n  const [dragY, setDragY] = useState(0);\r\n\r\n  const formatDistance = (meters: number): string => {\r\n    if (meters < 1000) {\r\n      return `${Math.round(meters)}m`;\r\n    }\r\n    return `${(meters / 1000).toFixed(2)}km`;\r\n  };\r\n\r\n  const formatTime = (seconds: number): string => {\r\n    if (seconds < 60) {\r\n      return \"< 1 min\";\r\n    }\r\n    const minutes = Math.ceil(seconds / 60);\r\n    return minutes === 1 ? \"1 min\" : `${minutes} mins`;\r\n  };\r\n\r\n  const formatBearing = (degrees: number | null): string => {\r\n    if (degrees === null) return \"N\";\r\n    const directions = [\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\"];\r\n    const index = Math.round(degrees / 45) % 8;\r\n    return directions[index];\r\n  };\r\n\r\n  const etaTime = useMemo(() => {\r\n    if (!routeProgress?.estimatedTimeRemaining) {\r\n      return \"\";\r\n    }\r\n    const now = new Date();\r\n    const eta = new Date(now.getTime() + routeProgress.estimatedTimeRemaining * 1000);\r\n    return eta.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n  }, [routeProgress?.estimatedTimeRemaining]);\r\n\r\n  const displayDistance = routeProgress?.distanceToDestination ?? routeInfo?.distance ?? 0;\r\n  const displayTime = routeProgress?.estimatedTimeRemaining ?? (routeInfo?.estimatedTime ? routeInfo.estimatedTime * 60 : 0);\r\n  const percentComplete = routeProgress?.percentComplete ?? 0;\r\n\r\n  const handleDrag = (_: any, info: PanInfo) => {\r\n    setDragY(info.offset.y);\r\n  };\r\n\r\n  const handleDragEnd = (_: any, info: PanInfo) => {\r\n    if (info.offset.y > 100 && onClose) {\r\n      onClose();\r\n    }\r\n    setDragY(0);\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      drag=\"y\"\r\n      dragConstraints={{ top: 0, bottom: 300 }}\r\n      dragElastic={0.2}\r\n      onDrag={handleDrag}\r\n      onDragEnd={handleDragEnd}\r\n      initial={{ y: \"100%\" }}\r\n      animate={{ y: 0 }}\r\n      exit={{ y: \"100%\" }}\r\n      transition={{ type: \"spring\", damping: 30, stiffness: 300 }}\r\n      className=\"fixed bottom-0 left-0 right-0 bg-white shadow-2xl z-50 rounded-t-3xl max-h-[85vh] overflow-hidden\"\r\n      style={{\r\n        boxShadow: \"0 -10px 40px rgba(0, 0, 0, 0.2)\",\r\n      }}\r\n    >\r\n      {/* Drag Handle */}\r\n      <div className=\"w-full flex justify-center py-3 cursor-grab active:cursor-grabbing bg-gradient-to-b from-gray-50 to-white\">\r\n        <motion.div\r\n          animate={{ scaleX: dragY > 0 ? 1.5 : 1 }}\r\n          className=\"w-12 h-1.5 bg-gray-300 rounded-full\"\r\n        />\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"px-4 pb-4 max-h-[calc(85vh-3rem)] overflow-y-auto\">\r\n        {/* Progress Bar */}\r\n        {routeProgress && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"mb-4\"\r\n          >\r\n            <div className=\"relative w-full h-3 bg-gray-200 rounded-full overflow-hidden shadow-inner\">\r\n              <motion.div\r\n                className=\"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full\"\r\n                initial={{ width: 0 }}\r\n                animate={{ width: `${Math.min(100, percentComplete)}%` }}\r\n                transition={{ duration: 0.5, ease: \"easeOut\" }}\r\n              >\r\n                <div className=\"absolute inset-0 bg-white/30 animate-pulse\"></div>\r\n              </motion.div>\r\n            </div>\r\n            <div className=\"flex justify-between mt-2\">\r\n              <motion.span\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                transition={{ delay: 0.2 }}\r\n                className=\"text-xs font-semibold text-blue-600\"\r\n              >\r\n                {percentComplete.toFixed(0)}% Complete\r\n              </motion.span>\r\n              {etaTime && (\r\n                <motion.span\r\n                  initial={{ opacity: 0 }}\r\n                  animate={{ opacity: 1 }}\r\n                  transition={{ delay: 0.3 }}\r\n                  className=\"text-xs font-semibold text-purple-600\"\r\n                >\r\n                  ETA: {etaTime}\r\n                </motion.span>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {/* Off Route Warning */}\r\n        <AnimatePresence>\r\n          {routeProgress?.isOffRoute && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -20, scale: 0.9 }}\r\n              animate={{ opacity: 1, y: 0, scale: 1 }}\r\n              exit={{ opacity: 0, y: -20, scale: 0.9 }}\r\n              className=\"mb-4 p-4 bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-300 rounded-2xl flex items-center shadow-lg\"\r\n            >\r\n              <motion.div\r\n                animate={{ rotate: [0, 10, -10, 0] }}\r\n                transition={{ repeat: Infinity, duration: 2 }}\r\n                className=\"text-3xl mr-3\"\r\n              >\r\n                ⚠️\r\n              </motion.div>\r\n              <div className=\"flex-1\">\r\n                <p className=\"text-sm font-bold text-orange-900\">\r\n                  You're off the route!\r\n                </p>\r\n                <p className=\"text-xs text-orange-700\">\r\n                  {formatDistance(routeProgress.distanceFromRoute)} away from path\r\n                </p>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Destination Info */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.1 }}\r\n          className=\"mb-4\"\r\n        >\r\n          <div className=\"flex items-center mb-2\">\r\n            <motion.div\r\n              animate={{ scale: [1, 1.1, 1] }}\r\n              transition={{ repeat: Infinity, duration: 2 }}\r\n              className=\"w-10 h-10 bg-gradient-to-br from-red-500 to-pink-500 rounded-2xl flex items-center justify-center text-white shadow-lg mr-3\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </motion.div>\r\n            <div className=\"flex-1\">\r\n              <h2 className=\"text-2xl font-bold text-gray-900 leading-tight\">\r\n                {destination.name}\r\n              </h2>\r\n              {destination.category && (\r\n                <span className=\"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full mt-1\">\r\n                  <span className=\"w-1.5 h-1.5 bg-blue-500 rounded-full mr-1.5 animate-pulse\"></span>\r\n                  {destination.category}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Real-time Metrics */}\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          transition={{ delay: 0.2 }}\r\n          className=\"grid grid-cols-3 gap-3 mb-4\"\r\n        >\r\n          {[\r\n            { label: \"Distance\", value: formatDistance(displayDistance), icon: \"🎯\", gradient: \"from-blue-500 to-blue-600\", bgGradient: \"from-blue-50 to-blue-100\" },\r\n            { label: \"Time\", value: formatTime(displayTime), icon: \"⏱️\", gradient: \"from-purple-500 to-purple-600\", bgGradient: \"from-purple-50 to-purple-100\" },\r\n            { label: \"Direction\", value: formatBearing(routeProgress?.bearingToNextWaypoint ?? null), icon: \"🧭\", gradient: \"from-pink-500 to-pink-600\", bgGradient: \"from-pink-50 to-pink-100\" }\r\n          ].map((metric, index) => (\r\n            <motion.div\r\n              key={index}\r\n              initial={{ scale: 0, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              transition={{ delay: 0.3 + index * 0.1, type: \"spring\" }}\r\n              whileHover={{ scale: 1.05, y: -5 }}\r\n              className={`bg-gradient-to-br ${metric.bgGradient} rounded-2xl p-4 shadow-md relative overflow-hidden`}\r\n            >\r\n              <div className={`absolute top-0 right-0 w-16 h-16 bg-gradient-to-br ${metric.gradient} opacity-10 rounded-bl-full`}></div>\r\n              <div className=\"relative z-10\">\r\n                <div className=\"text-2xl mb-1\">{metric.icon}</div>\r\n                <p className=\"text-xs text-gray-600 mb-1 font-medium\">{metric.label}</p>\r\n                <p className=\"text-lg font-bold text-gray-900\">{metric.value}</p>\r\n              </div>\r\n            </motion.div>\r\n          ))}\r\n        </motion.div>\r\n\r\n        {/* Expanded Info */}\r\n        <AnimatePresence>\r\n          {isPanelExpanded && (\r\n            <motion.div\r\n              initial={{ opacity: 0, height: 0 }}\r\n              animate={{ opacity: 1, height: \"auto\" }}\r\n              exit={{ opacity: 0, height: 0 }}\r\n              transition={{ duration: 0.3 }}\r\n              className=\"border-t border-gray-200 pt-4 mb-4 overflow-hidden\"\r\n            >\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                {[\r\n                  { label: \"Traveled\", value: formatDistance(routeProgress?.distanceTraveled ?? 0), icon: \"📍\" },\r\n                  { label: \"Calories\", value: `${Math.round(((routeProgress?.distanceTraveled ?? 0) / 1000) * 65)} cal`, icon: \"🔥\" },\r\n                  { label: \"Location\", value: currentLocation?.name ?? \"Locating...\", icon: \"📌\" },\r\n                  { label: \"Next Point\", value: formatDistance(routeProgress?.distanceToNextWaypoint ?? 0), icon: \"➡️\" }\r\n                ].map((stat, index) => (\r\n                  <motion.div\r\n                    key={index}\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: index * 0.1 }}\r\n                    className=\"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 shadow-sm\"\r\n                  >\r\n                    <div className=\"flex items-center mb-1\">\r\n                      <span className=\"text-lg mr-2\">{stat.icon}</span>\r\n                      <p className=\"text-xs text-gray-600 font-medium\">{stat.label}</p>\r\n                    </div>\r\n                    <p className=\"font-bold text-gray-900 truncate\">{stat.value}</p>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex gap-2 mb-4\">\r\n          <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={() => setShowDirections(!showDirections)}\r\n            className={`flex-1 py-3 px-4 rounded-2xl font-semibold transition-all shadow-md ${\r\n              showDirections\r\n                ? \"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg\"\r\n                : \"bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700\"\r\n            }`}\r\n          >\r\n            <div className=\"flex items-center justify-center\">\r\n              <svg className=\"w-5 h-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n              </svg>\r\n              {showDirections ? \"Hide\" : \"Show\"} Steps\r\n            </div>\r\n          </motion.button>\r\n\r\n          <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={() => setIsPanelExpanded(!isPanelExpanded)}\r\n            className=\"px-4 py-3 rounded-2xl bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 font-semibold shadow-md\"\r\n          >\r\n            <svg className={`w-6 h-6 transition-transform ${isPanelExpanded ? \"rotate-180\" : \"\"}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n            </svg>\r\n          </motion.button>\r\n\r\n          {onClose && (\r\n            <motion.button\r\n              whileHover={{ scale: 1.02 }}\r\n              whileTap={{ scale: 0.98 }}\r\n              onClick={onClose}\r\n              className=\"px-4 py-3 rounded-2xl bg-gradient-to-r from-red-500 to-pink-500 text-white font-semibold shadow-lg\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </motion.button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Step-by-Step Directions */}\r\n        <AnimatePresence>\r\n          {showDirections && (\r\n            <motion.div\r\n              initial={{ opacity: 0, height: 0 }}\r\n              animate={{ opacity: 1, height: \"auto\" }}\r\n              exit={{ opacity: 0, height: 0 }}\r\n              transition={{ duration: 0.3 }}\r\n              className=\"border-t border-gray-200 pt-4 overflow-hidden\"\r\n            >\r\n              <div className=\"flex items-center mb-4\">\r\n                <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl flex items-center justify-center text-white mr-3\">\r\n                  <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7\" />\r\n                  </svg>\r\n                </div>\r\n                <h3 className=\"font-bold text-gray-900 text-lg\">Navigation Steps</h3>\r\n              </div>\r\n\r\n              <div className=\"space-y-3 max-h-64 overflow-y-auto pr-2\">\r\n                {[\r\n                  { step: 1, title: `Start at ${currentLocation?.name ?? \"current location\"}`, desc: `Head ${formatBearing(routeProgress?.bearingToNextWaypoint ?? null)} toward ${destination.name}`, icon: \"🟢\", color: \"green\" },\r\n                  { step: 2, title: \"Follow the highlighted path\", desc: routeProgress?.isOffRoute ? \"⚠️ Return to the marked route\" : `Continue for ${formatDistance(displayDistance * 0.6)}`, icon: \"🔵\", color: \"blue\" },\r\n                  { step: 3, title: `Arrive at ${destination.name}`, desc: destination.description ?? \"Your destination\", icon: \"🔴\", color: \"red\" }\r\n                ].map((navStep, index) => (\r\n                  <motion.div\r\n                    key={index}\r\n                    initial={{ x: -20, opacity: 0 }}\r\n                    animate={{ x: 0, opacity: 1 }}\r\n                    transition={{ delay: index * 0.1 }}\r\n                    className={`flex items-start p-4 bg-gradient-to-r from-${navStep.color}-50 to-${navStep.color}-100 rounded-2xl shadow-sm border border-${navStep.color}-200`}\r\n                  >\r\n                    <div className=\"text-3xl mr-3\">{navStep.icon}</div>\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"font-bold text-gray-900 mb-1\">{navStep.title}</p>\r\n                      <p className=\"text-sm text-gray-700\">{navStep.desc}</p>\r\n                    </div>\r\n                    <div className={`w-8 h-8 bg-${navStep.color}-500 rounded-full flex items-center justify-center text-white font-bold shadow-md`}>\r\n                      {navStep.step}\r\n                    </div>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n\r\n      {/* Live Indicator */}\r\n      <motion.div\r\n        initial={{ scale: 0, opacity: 0 }}\r\n        animate={{ scale: 1, opacity: 1 }}\r\n        transition={{ delay: 0.5, type: \"spring\" }}\r\n        className=\"absolute top-6 right-4 flex items-center bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg\"\r\n      >\r\n        <motion.span\r\n          animate={{ scale: [1, 1.2, 1] }}\r\n          transition={{ repeat: Infinity, duration: 1.5 }}\r\n          className=\"w-2 h-2 bg-white rounded-full mr-2\"\r\n        />\r\n        LIVE\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default EnhancedMobileRoutePanel;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4567, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4573, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Projects/Thesis/UCWAYS/UCLM_OpenLayersMapping/components/map/MapComponent.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  useCallback,\r\n  useMemo,\r\n} from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\nimport \"ol/ol.css\";\r\nimport Map from \"ol/Map\";\r\nimport { fromLonLat, toLonLat } from \"ol/proj\";\r\nimport { Feature } from \"ol\";\r\nimport { Style, Stroke } from \"ol/style\";\r\nimport { Vector as VectorSource } from \"ol/source\";\r\nimport { Vector as VectorLayer } from \"ol/layer\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { containsCoordinate, Extent } from \"ol/extent\";\r\nimport Point from \"ol/geom/Point\";\r\nimport View from \"ol/View\";\r\nimport Geometry from \"ol/geom/Geometry\";\r\n\r\nimport { getSafeCoordinates } from \"./typeSafeGeometryUtils\";\r\nimport { useRouteProcessor } from \"./routeProcessor\";\r\n\r\nimport { MapProps } from \"./types\";\r\nimport { setupLayers } from \"./layers\";\r\nimport { setupLocationTracking } from \"./locationTracking\";\r\nimport {\r\n  setupEnhancedLocationTracking,\r\n  EnhancedLocationTracker,\r\n  RouteProgress,\r\n  UserPosition,\r\n} from \"./enhancedLocationTracking\";\r\nimport {\r\n  setupEditControls,\r\n  toggleDrawInteraction,\r\n  deleteSelectedFeature,\r\n  exportGeoJSON,\r\n} from \"./editControls\";\r\nimport {\r\n  CustomizationPanel,\r\n  EditControls,\r\n} from \"./components\";\r\nimport {\r\n  setupRoadSystem,\r\n  findClosestNode,\r\n  findShortestPath,\r\n  RoadNode,\r\n} from \"./roadSystem\";\r\nimport { generateRouteQR, parseRouteFromUrl, RouteData } from \"./qrCodeUtils\";\r\nimport DestinationSelector from \"./DestinationSelector\";\r\nimport { useKioskRouteManager } from \"./qrCodeUtils\";\r\nimport KioskQRModal from \"./KioskQRModal\";\r\nimport RouteOverlay from \"./RouteOverlay\";\r\nimport EnhancedMobileRoutePanel from \"./EnhancedMobileRoutePanel\";\r\nimport router from \"next/router\";\r\nimport GeoJSON from \"ol/format/GeoJSON\";\r\n\r\nconst CampusMap: React.FC<MapProps> = ({\r\n  mapUrl = \"/UCLM_Map.geojson\",\r\n  pointsUrl = \"/UCLM_Points.geojson\",\r\n  roadsUrl = \"/UCLM_Roads.geojson\",\r\n  nodesUrl = \"/UCLM_Nodes.geojson\",\r\n  backdropColor = \"#f7f2e4\",\r\n  initialZoom = 15,\r\n  centerCoordinates = [123.9545, 10.3265],\r\n  routeData,\r\n  mobileMode = false,\r\n  debug = false,\r\n  searchParams,\r\n}) => {\r\n  const routerSearchParams = useSearchParams();\r\n  const effectiveSearchParams = searchParams || routerSearchParams;\r\n\r\n  const mapRef = useRef<HTMLDivElement>(null);\r\n  const [isEditMode, setIsEditMode] = useState<boolean>(false);\r\n  const [drawType, setDrawType] = useState<\r\n    \"Point\" | \"LineString\" | \"Polygon\" | null\r\n  >(null);\r\n\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState<boolean>(false);\r\n  const [loadingState, setLoadingState] = useState<string>(\"\");\r\n\r\n  // Feature customization state\r\n  const [showCustomizePanel, setShowCustomizePanel] = useState<boolean>(false);\r\n  const [selectedFeature, setSelectedFeature] = useState<Feature | null>(null);\r\n  const [featureProperties, setFeatureProperties] = useState<{\r\n    [key: string]: any;\r\n  }>({});\r\n  const markerSizeOptions = useMemo(() => [\"small\", \"medium\", \"large\"], []);\r\n\r\n  // Road system and navigation state\r\n  const [showDestinationSelector, setShowDestinationSelector] =\r\n    useState<boolean>(false);\r\n  const [destinations, setDestinations] = useState<RoadNode[]>([]);\r\n  const [selectedDestination, setSelectedDestination] =\r\n    useState<RoadNode | null>(null);\r\n  const [currentLocation, setCurrentLocation] = useState<RoadNode | null>(null);\r\n  const [activeRoute, setActiveRoute] = useState<Feature[]>([]);\r\n  const [showRouteOverlay, setShowRouteOverlay] = useState<boolean>(false);\r\n  const [routeInfo, setRouteInfo] = useState<\r\n    { distance: number; estimatedTime: number } | undefined\r\n  >(undefined);\r\n  const allFeaturesRef = useRef<Feature[]>([]);\r\n\r\n  // User location permission state\r\n  const [locationPermissionRequested, setLocationPermissionRequested] =\r\n    useState<boolean>(false);\r\n  const [locationTrackingEnabled, setLocationTrackingEnabled] =\r\n    useState<boolean>(false);\r\n  const [defaultStartLocation, setDefaultStartLocation] =\r\n    useState<RoadNode | null>(null);\r\n\r\n  const {\r\n    qrCodeUrl,\r\n    showQRModal,\r\n    isGenerating,\r\n    error,\r\n    generateRouteQRCode,\r\n    closeQRModal,\r\n    resetKiosk,\r\n  } = useKioskRouteManager({\r\n    currentLocation,\r\n    selectedDestination,\r\n    routeInfo,\r\n    defaultStartLocation,\r\n  });\r\n  // Map instance and source references\r\n  const mapInstanceRef = useRef<Map | null>(null);\r\n  const vectorSourceRef = useRef<VectorSource<Feature<Geometry>> | null>(null);\r\n  const pointsSourceRef = useRef<VectorSource<Feature<Geometry>> | null>(null);\r\n  const drawInteractionRef = useRef<any>(null);\r\n  const modifyInteractionRef = useRef<any>(null);\r\n  const selectInteractionRef = useRef<any>(null);\r\n\r\n  // Road system references\r\n  const roadsSourceRef = useRef<VectorSource<Feature<Geometry>> | null>(null);\r\n  const nodesSourceRef = useRef<VectorSource<Feature<Geometry>> | null>(null);\r\n  const routeLayerRef = useRef<VectorLayer<\r\n    VectorSource<Feature<Geometry>>\r\n  > | null>(null);\r\n\r\n  // Store UI in refs to minimize re-renders\r\n  const locationErrorRef = useRef<string | null>(null);\r\n  const [locationError, setLocationError] = useState<string | null>(null);\r\n  const isOutsideSchoolRef = useRef<boolean>(false);\r\n  const [isOutsideSchool, setIsOutsideSchool] = useState<boolean>(false);\r\n  const schoolBoundaryRef = useRef<Extent | null>(null);\r\n  const updatePositionTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const lastValidCenterRef = useRef<number[] | null>(null);\r\n  const expandedExtentRef = useRef<Extent | null>(null);\r\n  const isUpdatingPositionRef = useRef<boolean>(false);\r\n  const locationWatchIdRef = useRef<number | null>(null);\r\n  const locationNodeIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Enhanced location tracking\r\n  const enhancedTrackerRef = useRef<EnhancedLocationTracker | null>(null);\r\n  const [routeProgress, setRouteProgress] = useState<RouteProgress | null>(null);\r\n  const [userPosition, setUserPosition] = useState<UserPosition | null>(null);\r\n  const [useEnhancedTracking, setUseEnhancedTracking] = useState<boolean>(true);\r\n\r\n  const requestLocationPermission = useCallback(() => {\r\n    setLocationPermissionRequested(true);\r\n\r\n    // This will now be in response to a user gesture\r\n    navigator.geolocation.getCurrentPosition(\r\n      () => {\r\n        // Start location tracking now that we have permission\r\n        const cleanup = initLocationTracking();\r\n        return () => {\r\n          if (cleanup) cleanup();\r\n        };\r\n      },\r\n      (error) => {\r\n        console.error(\"Location permission denied\", error);\r\n        setLocationError(\r\n          \"Location permission denied. Using default entry point for navigation.\"\r\n        );\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  const initLocationTracking = useCallback(() => {\r\n    if (!mapInstanceRef.current) return undefined;\r\n\r\n    setLocationTrackingEnabled(true);\r\n\r\n    // Use enhanced tracking for mobile mode\r\n    if (mobileMode && useEnhancedTracking) {\r\n      // Create enhanced tracker\r\n      const tracker = setupEnhancedLocationTracking(\r\n        mapInstanceRef.current,\r\n        {\r\n          autoFollow: true,\r\n          rotateMap: true,\r\n          smoothAnimation: true,\r\n          animationDuration: 1000,\r\n          zoomLevel: 19,\r\n          showAccuracyCircle: true,\r\n          showDirectionArrow: true,\r\n          trackingMode: \"route\",\r\n        },\r\n        locationErrorRef,\r\n        isOutsideSchoolRef,\r\n        schoolBoundaryRef\r\n      );\r\n\r\n      enhancedTrackerRef.current = tracker;\r\n\r\n      // Start tracking with callbacks\r\n      tracker.startTracking(\r\n        (position: UserPosition) => {\r\n          setUserPosition(position);\r\n\r\n          // Update current location node\r\n          if (nodesSourceRef.current) {\r\n            const closestNode = findClosestNode(\r\n              position.coordinates[0],\r\n              position.coordinates[1],\r\n              nodesSourceRef.current\r\n            );\r\n\r\n            if (\r\n              closestNode &&\r\n              (!currentLocation || closestNode.id !== currentLocation.id)\r\n            ) {\r\n              setCurrentLocation(closestNode);\r\n\r\n              // If there's an active destination, update the route\r\n              if (selectedDestination) {\r\n                displayRoute(closestNode.id, selectedDestination.id);\r\n              }\r\n            }\r\n          }\r\n        },\r\n        (progress: RouteProgress) => {\r\n          setRouteProgress(progress);\r\n        }\r\n      );\r\n\r\n      // Return cleanup function\r\n      return () => {\r\n        if (enhancedTrackerRef.current) {\r\n          enhancedTrackerRef.current.stopTracking();\r\n          enhancedTrackerRef.current.destroy();\r\n          enhancedTrackerRef.current = null;\r\n        }\r\n      };\r\n    } else {\r\n      // Use standard tracking for desktop\r\n      const { watchId, userPositionFeature } = setupLocationTracking(\r\n        mapInstanceRef.current,\r\n        locationErrorRef,\r\n        isOutsideSchoolRef,\r\n        schoolBoundaryRef,\r\n        isUpdatingPositionRef\r\n      );\r\n\r\n      locationWatchIdRef.current = watchId;\r\n\r\n      // Update current location node when user position changes\r\n      const updateCurrentLocationNode = () => {\r\n        if (\r\n          !userPositionFeature ||\r\n          !nodesSourceRef.current ||\r\n          isUpdatingPositionRef.current\r\n        )\r\n          return;\r\n\r\n        const geometry = userPositionFeature.getGeometry();\r\n        if (!geometry) return;\r\n\r\n        const coords = geometry.getFirstCoordinate\r\n          ? geometry.getFirstCoordinate()\r\n          : geometry instanceof Point\r\n            ? geometry.getCoordinates()\r\n            : null;\r\n        if (!coords) return;\r\n\r\n        // Convert to geo coordinates\r\n        const geoCoords = toLonLat(coords);\r\n\r\n        // Find the closest node\r\n        const closestNode = findClosestNode(\r\n          geoCoords[0],\r\n          geoCoords[1],\r\n          nodesSourceRef.current\r\n        );\r\n\r\n        if (\r\n          closestNode &&\r\n          (!currentLocation || closestNode.id !== currentLocation.id)\r\n        ) {\r\n          setCurrentLocation(closestNode);\r\n\r\n          // If there's an active destination, update the route\r\n          if (selectedDestination) {\r\n            displayRoute(closestNode.id, selectedDestination.id);\r\n          }\r\n        }\r\n      };\r\n\r\n      // Set up timer to update current location node\r\n      const locationNodeInterval = setInterval(updateCurrentLocationNode, 3000);\r\n      locationNodeIntervalRef.current = locationNodeInterval;\r\n\r\n      // Return cleanup function\r\n      return () => {\r\n        if (locationWatchIdRef.current) {\r\n          navigator.geolocation.clearWatch(locationWatchIdRef.current);\r\n          locationWatchIdRef.current = null;\r\n        }\r\n        if (locationNodeIntervalRef.current) {\r\n          clearInterval(locationNodeIntervalRef.current);\r\n          locationNodeIntervalRef.current = null;\r\n        }\r\n      };\r\n    }\r\n  }, [currentLocation, selectedDestination, mobileMode, useEnhancedTracking]);\r\n\r\n  const getFeatureCoordinates = (feature: Feature<Geometry>) => {\r\n    const geometry = feature.getGeometry();\r\n    if (geometry && geometry instanceof Point) {\r\n      const coords = geometry.getCoordinates();\r\n      const geoCoords = toLonLat(coords);\r\n      // Explicitly cast to [number, number] tuple\r\n      return geoCoords as [number, number];\r\n    }\r\n    return [0, 0] as [number, number]; // Default coordinates as tuple\r\n  };\r\n\r\n  // Helper function to process the route data\r\n  const processRouteData = (routeData: RouteData) => {\r\n    // Check if sources are available\r\n    if (!nodesSourceRef.current) {\r\n      console.error(\"Nodes source not initialized\");\r\n      return;\r\n    }\r\n\r\n    // Find start and end nodes\r\n    const startNodeId = routeData.startNodeId;\r\n    const endNodeId = routeData.endNodeId;\r\n\r\n    console.log(`Processing route from ${startNodeId} to ${endNodeId}`);\r\n\r\n    const features = nodesSourceRef.current.getFeatures();\r\n\r\n    const startFeature = features.find((f) => f.get(\"id\") === startNodeId);\r\n    const endFeature = features.find((f) => f.get(\"id\") === endNodeId);\r\n\r\n    if (!startFeature || !endFeature) {\r\n      console.error(\"Could not find start or end node features\");\r\n      return;\r\n    }\r\n\r\n    // Create node objects\r\n    const startNode = {\r\n      id: startFeature.get(\"id\"),\r\n      name: startFeature.get(\"name\") || \"Start\",\r\n      isDestination: true,\r\n      coordinates: getFeatureCoordinates(startFeature),\r\n      category: startFeature.get(\"category\"),\r\n    };\r\n\r\n    const endNode = {\r\n      id: endFeature.get(\"id\"),\r\n      name: endFeature.get(\"name\") || \"Destination\",\r\n      isDestination: true,\r\n      coordinates: getFeatureCoordinates(endFeature),\r\n      category: endFeature.get(\"category\"),\r\n    };\r\n\r\n    // Set nodes in state\r\n    setCurrentLocation(startNode);\r\n    setSelectedDestination(endNode);\r\n\r\n    // Find and display route\r\n    displayRoute(startNode.id, endNode.id);\r\n\r\n    // Set route UI to visible\r\n    setShowRouteOverlay(true);\r\n\r\n    // Set route info if available\r\n    if (routeData.routeInfo) {\r\n      setRouteInfo(routeData.routeInfo);\r\n    }\r\n  };\r\n\r\n  // Update feature property\r\n  const updateFeatureProperty = useCallback(\r\n    (property: string, value: any) => {\r\n      if (!selectedFeature) return;\r\n\r\n      selectedFeature.set(property, value);\r\n\r\n      // Update local state to reflect changes\r\n      setFeatureProperties((prev) => ({\r\n        ...prev,\r\n        [property]: value,\r\n      }));\r\n    },\r\n    [selectedFeature]\r\n  );\r\n\r\n  // Handle destination selection\r\n  const handleDestinationSelect = useCallback(\r\n    (destination: RoadNode) => {\r\n      setSelectedDestination(destination);\r\n      setShowDestinationSelector(false);\r\n\r\n      if (currentLocation) {\r\n        // Find and display the route from current location\r\n        displayRoute(currentLocation.id, destination.id);\r\n      } else if (defaultStartLocation) {\r\n        // Use default start location (main gate) when current location is not available\r\n        displayRoute(defaultStartLocation.id, destination.id);\r\n      } else {\r\n        // Show error message to user\r\n        setLocationError(\r\n          \"No starting point available. Please grant location permission or try again.\"\r\n        );\r\n      }\r\n    },\r\n    [currentLocation, defaultStartLocation]\r\n  );\r\n\r\n  // Display route between two nodes\r\n  const displayRoute = useCallback(\r\n    (startNodeId: string, endNodeId: string) => {\r\n      if (\r\n        !roadsSourceRef.current ||\r\n        !nodesSourceRef.current ||\r\n        !mapInstanceRef.current\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      // Clear existing route\r\n      if (routeLayerRef.current) {\r\n        mapInstanceRef.current.removeLayer(routeLayerRef.current);\r\n        routeLayerRef.current = null;\r\n      }\r\n\r\n      // Find the shortest path\r\n      const pathFeatures = findShortestPath(\r\n        startNodeId,\r\n        endNodeId,\r\n        roadsSourceRef.current,\r\n        nodesSourceRef.current\r\n      );\r\n\r\n      if (pathFeatures.length === 0) {\r\n        return;\r\n      }\r\n\r\n      // Create a route source and layer\r\n      const routeSource = new VectorSource({\r\n        features: pathFeatures,\r\n      });\r\n\r\n      const routeLayer = new VectorLayer({\r\n        source: routeSource,\r\n        style: new Style({\r\n          stroke: new Stroke({\r\n            color: \"#4285F4\",\r\n            width: 6,\r\n            lineDash: [],\r\n          }),\r\n          zIndex: 10,\r\n        }),\r\n      });\r\n\r\n      // Add the layer to the map\r\n      mapInstanceRef.current.addLayer(routeLayer);\r\n      routeLayerRef.current = routeLayer;\r\n\r\n      // Calculate route information (distance and time)\r\n      let totalDistance = 0;\r\n      pathFeatures.forEach((feature) => {\r\n        const geometry = feature.getGeometry();\r\n        if (geometry) {\r\n          // Check if the geometry is a LineString that has getLength method\r\n          if (geometry.getType() === \"LineString\") {\r\n            try {\r\n              // Use type assertion to access getLength\r\n              const lineString =\r\n                geometry as import(\"ol/geom/LineString\").default;\r\n              totalDistance += lineString.getLength(); // in meters\r\n            } catch (error) {\r\n              console.error(\"Error calculating line length:\", error);\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      // Estimate time (assuming walking speed of 5km/h = 1.38m/s)\r\n      const estimatedTimeMinutes = totalDistance / (1.38 * 60);\r\n\r\n      setRouteInfo({\r\n        distance: totalDistance,\r\n        estimatedTime: estimatedTimeMinutes,\r\n      });\r\n\r\n      setActiveRoute(pathFeatures);\r\n      setShowRouteOverlay(true);\r\n\r\n      // Set route path for enhanced tracking\r\n      if (enhancedTrackerRef.current && mobileMode) {\r\n        // Extract route coordinates from path features\r\n        const routePath: [number, number][] = [];\r\n        pathFeatures.forEach((feature) => {\r\n          const geometry = feature.getGeometry();\r\n          if (geometry && geometry.getType() === \"LineString\") {\r\n            const lineString = geometry as import(\"ol/geom/LineString\").default;\r\n            const coords = lineString.getCoordinates();\r\n            coords.forEach((coord) => {\r\n              const geoCoord = toLonLat(coord);\r\n              routePath.push([geoCoord[0], geoCoord[1]]);\r\n            });\r\n          }\r\n        });\r\n\r\n        if (routePath.length > 0) {\r\n          enhancedTrackerRef.current.setRoute(routePath);\r\n        }\r\n      }\r\n    },\r\n    [mobileMode]\r\n  );\r\n\r\n  // Generate QR code for the current route\r\n  const handleGenerateQR = useCallback(() => {\r\n    generateRouteQRCode();\r\n  }, [generateRouteQRCode]);\r\n\r\n  // Clear active route\r\n  const clearRoute = useCallback(() => {\r\n    if (routeLayerRef.current && mapInstanceRef.current) {\r\n      mapInstanceRef.current.removeLayer(routeLayerRef.current);\r\n      routeLayerRef.current = null;\r\n    }\r\n\r\n    setActiveRoute([]);\r\n    setSelectedDestination(null);\r\n    setShowRouteOverlay(false);\r\n    setRouteInfo(undefined);\r\n    setRouteProgress(null);\r\n    resetRouteProcessor();\r\n\r\n    // Clear route from enhanced tracker\r\n    if (enhancedTrackerRef.current) {\r\n      enhancedTrackerRef.current.clearRoute();\r\n    }\r\n  }, []);\r\n\r\n  // Toggle edit mode - memoized\r\n  const toggleEditMode = useCallback(() => {\r\n    if (!mapInstanceRef.current) return;\r\n\r\n    const newEditMode = !isEditMode;\r\n    setIsEditMode(newEditMode);\r\n\r\n    setupEditControls(\r\n      newEditMode,\r\n      mapInstanceRef.current,\r\n      vectorSourceRef.current,\r\n      pointsSourceRef.current,\r\n      modifyInteractionRef,\r\n      selectInteractionRef,\r\n      drawInteractionRef,\r\n      setSelectedFeature,\r\n      setFeatureProperties,\r\n      setShowCustomizePanel,\r\n      setDrawType\r\n    );\r\n  }, [isEditMode]);\r\n\r\n  // Handle draw interaction toggles\r\n  const handleDrawInteractionToggle = useCallback(\r\n    (type: \"Point\" | \"LineString\" | \"Polygon\") => {\r\n      // If already active, toggle it off\r\n      if (drawType === type) {\r\n        toggleDrawInteraction(\r\n          null,\r\n          isEditMode,\r\n          mapInstanceRef.current,\r\n          vectorSourceRef.current,\r\n          pointsSourceRef.current,\r\n          drawInteractionRef,\r\n          selectInteractionRef,\r\n          setSelectedFeature,\r\n          setFeatureProperties,\r\n          setShowCustomizePanel\r\n        );\r\n        setDrawType(null);\r\n      } else {\r\n        // Otherwise, activate the new type\r\n        toggleDrawInteraction(\r\n          type,\r\n          isEditMode,\r\n          mapInstanceRef.current,\r\n          vectorSourceRef.current,\r\n          pointsSourceRef.current,\r\n          drawInteractionRef,\r\n          selectInteractionRef,\r\n          setSelectedFeature,\r\n          setFeatureProperties,\r\n          setShowCustomizePanel\r\n        );\r\n        setDrawType(type);\r\n      }\r\n    },\r\n    [drawType, isEditMode]\r\n  );\r\n\r\n  // Memoize handlers for UI components\r\n  const handleCloseCustomizePanel = useCallback(() => {\r\n    setShowCustomizePanel(false);\r\n  }, []);\r\n\r\n  const handleCloseDestinationSelector = useCallback(() => {\r\n    setShowDestinationSelector(false);\r\n  }, []);\r\n\r\n  const handleShowDestinationSelector = useCallback(() => {\r\n    setShowDestinationSelector(true);\r\n  }, []);\r\n\r\n  const handleDeleteSelected = useCallback(() => {\r\n    deleteSelectedFeature(\r\n      selectInteractionRef.current,\r\n      vectorSourceRef.current,\r\n      pointsSourceRef.current,\r\n      setShowCustomizePanel,\r\n      setSelectedFeature\r\n    );\r\n  }, []);\r\n\r\n  const { featuresReady, allFeatures, resetRouteProcessor } = useRouteProcessor(\r\n    nodesUrl,\r\n    roadsUrl,\r\n    mapInstanceRef,\r\n    displayRoute,\r\n    setCurrentLocation,\r\n    setSelectedDestination,\r\n    setRouteInfo,\r\n    setShowRouteOverlay,\r\n    routeData // This can be from props or from URL params\r\n  );\r\n\r\n  const handleExportMap = useCallback(() => {\r\n    exportGeoJSON(\r\n      vectorSourceRef.current,\r\n      \"map_export.geojson\"\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (effectiveSearchParams && mobileMode) {\r\n      console.log(\r\n        \"Mobile mode - checking URL params:\",\r\n        effectiveSearchParams.toString()\r\n      );\r\n\r\n      const routeData = parseRouteFromUrl(\r\n        effectiveSearchParams\r\n      );\r\n\r\n      if (routeData) {\r\n        console.log(\"Found route data:\", routeData);\r\n\r\n        // Wait for map and sources to be fully initialized\r\n        const checkSourcesLoaded = () => {\r\n          if (\r\n            mapInstanceRef.current &&\r\n            roadsSourceRef.current &&\r\n            roadsSourceRef.current.getState() === \"ready\" &&\r\n            nodesSourceRef.current &&\r\n            nodesSourceRef.current.getState() === \"ready\"\r\n          ) {\r\n            console.log(\"Sources ready, processing route\");\r\n            processRouteData(routeData);\r\n          } else {\r\n            console.log(\"Sources not ready yet, waiting...\");\r\n            setTimeout(checkSourcesLoaded, 300);\r\n          }\r\n        };\r\n\r\n        checkSourcesLoaded();\r\n      }\r\n    }\r\n  }, [effectiveSearchParams, mobileMode]);\r\n\r\n  const initializeMap = useCallback(() => {\r\n    if (!mapRef.current) return;\r\n\r\n    const updateUIStates = () => {\r\n      if (locationErrorRef.current !== locationError) {\r\n        setLocationError(locationErrorRef.current);\r\n      }\r\n      if (isOutsideSchoolRef.current !== isOutsideSchool) {\r\n        setIsOutsideSchool(isOutsideSchoolRef.current);\r\n      }\r\n    };\r\n\r\n    const uiUpdateInterval = setInterval(updateUIStates, 1000);\r\n\r\n    const { map, vectorSource, pointsSource, view } = setupLayers(\r\n      mapRef.current,\r\n      backdropColor,\r\n      centerCoordinates,\r\n      initialZoom,\r\n      mapUrl,\r\n      pointsUrl\r\n    );\r\n\r\n    mapInstanceRef.current = map;\r\n    vectorSourceRef.current = vectorSource;\r\n    pointsSourceRef.current = pointsSource;\r\n\r\n    const { roadsLayer, roadsSource, nodesSource } = setupRoadSystem(\r\n      roadsUrl,\r\n      nodesUrl\r\n    );\r\n\r\n    // Add road layer to map\r\n    map.addLayer(roadsLayer);\r\n\r\n    // Store road system refs\r\n    roadsSourceRef.current = roadsSource;\r\n    nodesSourceRef.current = nodesSource;\r\n\r\n    // Define a function to process features to avoid code duplication\r\n    const processFeatures = (features: Feature<Geometry>[]) => {\r\n      const loadedDestinations: RoadNode[] = [];\r\n\r\n      // Set default start location (main gate)\r\n      let mainGate: RoadNode | null = null;\r\n\r\n      features.forEach((feature: Feature<Geometry>) => {\r\n        const props = feature.getProperties();\r\n        const geometry = feature.getGeometry();\r\n\r\n        if (props.isDestination && geometry) {\r\n          // Handle geometry correctly\r\n          if (geometry instanceof Point) {\r\n            const coords = geometry.getCoordinates();\r\n\r\n            // Convert to geo coordinates\r\n            const geoCoords = toLonLat(coords);\r\n\r\n            // Create node object\r\n            const node: RoadNode = {\r\n              id:\r\n                props.id ||\r\n                `node-${Math.random().toString(36).substring(2, 9)}`,\r\n              name: props.name || \"Unnamed Location\",\r\n              isDestination: !!props.isDestination,\r\n              coordinates: geoCoords as [number, number],\r\n              description: props.description,\r\n              category: props.category || \"General\",\r\n              imageUrl: props.imageUrl,\r\n            };\r\n\r\n            // Find and set main gate as default starting point\r\n            if (props.category === \"Gates\" && props.id === \"gate1\") {\r\n              mainGate = node;\r\n            }\r\n\r\n            // Add to destinations\r\n            loadedDestinations.push(node);\r\n          }\r\n        }\r\n      });\r\n\r\n      // Set destinations in state\r\n      if (loadedDestinations.length > 0) {\r\n        setDestinations(loadedDestinations);\r\n\r\n        // Set default start location\r\n        if (mainGate) {\r\n          setDefaultStartLocation(mainGate);\r\n        }\r\n\r\n        // Check for pending route from URL parameters\r\n        processPendingRoute(loadedDestinations, mainGate);\r\n      } else {\r\n        loadDestinationsDirectly();\r\n      }\r\n    };\r\n\r\n    // Function to process pending route\r\n    const processPendingRoute = (\r\n      loadedDestinations: RoadNode[],\r\n      mainGate: RoadNode | null\r\n    ) => {\r\n      const pendingRouteData = sessionStorage.getItem(\"pendingRoute\");\r\n      if (pendingRouteData) {\r\n        try {\r\n          const routeData: RouteData = JSON.parse(pendingRouteData);\r\n\r\n          // Find nodes by ID\r\n          const startNode =\r\n            loadedDestinations.find((d) => d.id === routeData.startNodeId) ||\r\n            mainGate;\r\n          const endNode =\r\n            loadedDestinations.find((d) => d.id === routeData.endNodeId) ||\r\n            null;\r\n\r\n          if (startNode && endNode) {\r\n            // Use the default start node or the one from the URL\r\n            setCurrentLocation(startNode);\r\n            setSelectedDestination(endNode);\r\n\r\n            // Display the route\r\n            displayRoute(startNode.id, endNode.id);\r\n\r\n            // If route info was provided, use it\r\n            if (routeData.routeInfo) {\r\n              setRouteInfo(routeData.routeInfo);\r\n            }\r\n          }\r\n\r\n          // Clear the pending route\r\n          sessionStorage.removeItem(\"pendingRoute\");\r\n        } catch (error) {\r\n          console.error(\"Error processing pending route:\", error);\r\n        }\r\n      }\r\n    };\r\n\r\n    // Function to load destinations directly from GeoJSON\r\n    const loadDestinationsDirectly = () => {\r\n      fetch(nodesUrl)\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n          const directLoadedDestinations: RoadNode[] = [];\r\n          let mainGate: RoadNode | null = null;\r\n\r\n          data.features.forEach((feature: any) => {\r\n            if (feature.properties.isDestination) {\r\n              // Create node object directly from GeoJSON\r\n              const coords = feature.geometry.coordinates;\r\n              const node: RoadNode = {\r\n                id:\r\n                  feature.properties.id ||\r\n                  `node-${Math.random().toString(36).substring(2, 9)}`,\r\n                name: feature.properties.name || \"Unnamed Location\",\r\n                isDestination: true,\r\n                coordinates: coords as [number, number],\r\n                description: feature.properties.description,\r\n                category: feature.properties.category || \"General\",\r\n                imageUrl: feature.properties.imageUrl,\r\n              };\r\n\r\n              // Find and set main gate as default starting point\r\n              if (\r\n                feature.properties.category === \"Gates\" &&\r\n                feature.properties.id === \"gate1\"\r\n              ) {\r\n                mainGate = node;\r\n              }\r\n\r\n              directLoadedDestinations.push(node);\r\n            }\r\n          });\r\n\r\n          if (directLoadedDestinations.length > 0) {\r\n            setDestinations(directLoadedDestinations);\r\n            if (mainGate) {\r\n              setDefaultStartLocation(mainGate);\r\n            }\r\n\r\n            // Check for pending route\r\n            processPendingRoute(directLoadedDestinations, mainGate);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error loading destinations directly:\", error);\r\n        });\r\n    };\r\n\r\n    // Handle feature loaded event\r\n    const handleFeaturesLoaded = () => {\r\n      const features = nodesSource.getFeatures();\r\n      processFeatures(features);\r\n    };\r\n\r\n    // Register event for future loads\r\n    nodesSource.on(\"featuresloadend\", handleFeaturesLoaded);\r\n\r\n    // Also check if features are already loaded\r\n    if (nodesSource.getState() === \"ready\") {\r\n      const features = nodesSource.getFeatures();\r\n      processFeatures(features);\r\n    } else {\r\n      // If no features are available yet, try loading directly after a short delay\r\n      const checkFeaturesTimer = setTimeout(() => {\r\n        const features = nodesSource.getFeatures();\r\n        if (features.length > 0) {\r\n          processFeatures(features);\r\n        } else {\r\n          loadDestinationsDirectly();\r\n        }\r\n      }, 500);\r\n\r\n      // Clean up timer in component cleanup\r\n      updatePositionTimeoutRef.current = checkFeaturesTimer;\r\n    }\r\n\r\n    // Force a refresh/reload of the nodes source\r\n    try {\r\n      nodesSource.refresh();\r\n    } catch (e) {\r\n      console.error(\"Error refreshing source:\", e);\r\n    }\r\n    // Load destinations from nodes source\r\n    nodesSource.on(\"featuresloadend\", () => {\r\n      const features = nodesSource.getFeatures();\r\n\r\n      const loadedDestinations: RoadNode[] = [];\r\n\r\n      // Set default start location (main gate)\r\n      let mainGate: RoadNode | null = null;\r\n\r\n      features.forEach((feature: Feature<Geometry>) => {\r\n        const props = feature.getProperties();\r\n        const geometry = feature.getGeometry();\r\n\r\n        if (props.isDestination && geometry) {\r\n          // Handle geometry correctly\r\n          if (geometry instanceof Point) {\r\n            const coords = geometry.getCoordinates();\r\n\r\n            // Convert to geo coordinates\r\n            const geoCoords = toLonLat(coords);\r\n\r\n            // Create node object\r\n            const node: RoadNode = {\r\n              id:\r\n                props.id ||\r\n                `node-${Math.random().toString(36).substring(2, 9)}`,\r\n              name: props.name || \"Unnamed Location\",\r\n              isDestination: !!props.isDestination,\r\n              coordinates: geoCoords as [number, number],\r\n              description: props.description,\r\n              category: props.category || \"General\",\r\n              imageUrl: props.imageUrl,\r\n            };\r\n\r\n            // Find and set main gate as default starting point\r\n            if (props.category === \"Gates\" && props.id === \"gate1\") {\r\n              mainGate = node;\r\n            }\r\n\r\n            // Add to destinations\r\n            loadedDestinations.push(node);\r\n          }\r\n        }\r\n      });\r\n\r\n      // If no destinations were loaded, try to load them directly from the GeoJSON file\r\n      if (loadedDestinations.length === 0) {\r\n        fetch(nodesUrl)\r\n          .then((response) => response.json())\r\n          .then((data) => {\r\n            const directLoadedDestinations: RoadNode[] = [];\r\n\r\n            data.features.forEach((feature: any) => {\r\n              if (feature.properties.isDestination) {\r\n                // Create node object directly from GeoJSON\r\n                const coords = feature.geometry.coordinates;\r\n                const node: RoadNode = {\r\n                  id:\r\n                    feature.properties.id ||\r\n                    `node-${Math.random().toString(36).substring(2, 9)}`,\r\n                  name: feature.properties.name || \"Unnamed Location\",\r\n                  isDestination: true,\r\n                  coordinates: coords as [number, number],\r\n                  description: feature.properties.description,\r\n                  category: feature.properties.category || \"General\",\r\n                  imageUrl: feature.properties.imageUrl,\r\n                };\r\n\r\n                // Find and set main gate as default starting point\r\n                if (\r\n                  feature.properties.category === \"Gates\" &&\r\n                  feature.properties.id === \"gate1\"\r\n                ) {\r\n                  mainGate = node;\r\n                }\r\n\r\n                directLoadedDestinations.push(node);\r\n              }\r\n            });\r\n\r\n            if (directLoadedDestinations.length > 0) {\r\n              setDestinations(directLoadedDestinations);\r\n              if (mainGate) {\r\n                setDefaultStartLocation(mainGate);\r\n              }\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            console.error(\"Error loading destinations directly:\", error);\r\n          });\r\n      } else {\r\n        setDestinations(loadedDestinations);\r\n\r\n        // Set default start location\r\n        if (mainGate) {\r\n          setDefaultStartLocation(mainGate);\r\n        }\r\n      }\r\n\r\n      // Check for pending route from URL parameters\r\n      const pendingRouteData = sessionStorage.getItem(\"pendingRoute\");\r\n      if (pendingRouteData) {\r\n        try {\r\n          const routeData: RouteData = JSON.parse(pendingRouteData);\r\n\r\n          // Find nodes by ID\r\n          const startNode =\r\n            loadedDestinations.find((d) => d.id === routeData.startNodeId) ||\r\n            mainGate;\r\n          const endNode =\r\n            loadedDestinations.find((d) => d.id === routeData.endNodeId) ||\r\n            null;\r\n\r\n          if (startNode && endNode) {\r\n            // Use the default start node or the one from the URL\r\n            setCurrentLocation(startNode);\r\n            setSelectedDestination(endNode);\r\n\r\n            // Display the route\r\n            displayRoute(startNode.id, endNode.id);\r\n\r\n            // If route info was provided, use it\r\n            if (routeData.routeInfo) {\r\n              setRouteInfo(routeData.routeInfo);\r\n            }\r\n          }\r\n\r\n          // Clear the pending route\r\n          sessionStorage.removeItem(\"pendingRoute\");\r\n        } catch (error) {\r\n          console.error(\"Error processing pending route:\", error);\r\n        }\r\n      }\r\n    });\r\n\r\n    vectorSource.on(\"featuresloadend\", () => {\r\n      try {\r\n        const extent: Extent = vectorSource.getExtent();\r\n        const features = vectorSource.getFeatures();\r\n\r\n        // Store the school boundary for location checking\r\n        if (extent && extent.every((v) => isFinite(v))) {\r\n          // Add some padding to the boundary\r\n          const expandedBoundary: Extent = [\r\n            extent[0] - 500, // buffer in meters\r\n            extent[1] - 500,\r\n            extent[2] + 500,\r\n            extent[3] + 500,\r\n          ];\r\n          schoolBoundaryRef.current = expandedBoundary;\r\n        }\r\n\r\n        if (extent && extent.every((v) => isFinite(v))) {\r\n          const paddingFactor = 1.5;\r\n          const centerPoint = [\r\n            (extent[0] + extent[2]) / 2,\r\n            (extent[1] + extent[3]) / 2,\r\n          ];\r\n\r\n          const expanded: Extent = [\r\n            centerPoint[0] - ((extent[2] - extent[0]) * paddingFactor) / 2,\r\n            centerPoint[1] - ((extent[3] - extent[1]) * paddingFactor) / 2,\r\n            centerPoint[0] + ((extent[2] - extent[0]) * paddingFactor) / 2,\r\n            centerPoint[1] + ((extent[3] - extent[1]) * paddingFactor) / 2,\r\n          ];\r\n\r\n          // Store in ref for access from other functions\r\n          expandedExtentRef.current = expanded;\r\n\r\n          view.fit(extent, {\r\n            padding: [20, 20, 20, 20],\r\n            maxZoom: 18,\r\n          });\r\n\r\n          lastValidCenterRef.current = view.getCenter() || null;\r\n        } else {\r\n          console.error(\"Invalid map extent:\", extent);\r\n          view.setCenter(fromLonLat(centerCoordinates));\r\n          view.setZoom(initialZoom);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error processing map extent:\", error);\r\n      }\r\n    });\r\n\r\n    // FIX: Improve the pointerdrag handler to avoid state updates\r\n    let isUpdatingCenter = false;\r\n\r\n    map.on(\"pointerdrag\", () => {\r\n      if (isUpdatingCenter) return;\r\n\r\n      const currentCenter = view.getCenter();\r\n      if (!currentCenter || !expandedExtentRef.current) return;\r\n\r\n      if (!containsCoordinate(expandedExtentRef.current, currentCenter)) {\r\n        isUpdatingCenter = true;\r\n\r\n        try {\r\n          const clampedCenter = [\r\n            Math.max(\r\n              expandedExtentRef.current[0],\r\n              Math.min(currentCenter[0], expandedExtentRef.current[2])\r\n            ),\r\n            Math.max(\r\n              expandedExtentRef.current[1],\r\n              Math.min(currentCenter[1], expandedExtentRef.current[3])\r\n            ),\r\n          ];\r\n\r\n          // Only update if the center has significantly changed\r\n          if (\r\n            !lastValidCenterRef.current ||\r\n            Math.abs(clampedCenter[0] - (lastValidCenterRef.current[0] || 0)) >\r\n              0.1 ||\r\n            Math.abs(clampedCenter[1] - (lastValidCenterRef.current[1] || 0)) >\r\n              0.1\r\n          ) {\r\n            lastValidCenterRef.current = clampedCenter;\r\n            view.setCenter(clampedCenter);\r\n          }\r\n        } finally {\r\n          isUpdatingCenter = false;\r\n        }\r\n      } else {\r\n        lastValidCenterRef.current = currentCenter;\r\n      }\r\n    });\r\n\r\n    vectorSource.on(\"featuresloaderror\", (error: any) => {\r\n      console.error(\"Features load error:\", error);\r\n      locationErrorRef.current =\r\n        \"Failed to load map data. Please try again later.\";\r\n    });\r\n\r\n    const handleResize = () => {\r\n      try {\r\n        map.updateSize();\r\n        const extent: Extent = vectorSource.getExtent();\r\n        if (extent && extent.every((v) => isFinite(v))) {\r\n          view.fit(extent, {\r\n            padding: [20, 20, 20, 20],\r\n            maxZoom: 18,\r\n          });\r\n        }\r\n      } catch (resizeError) {\r\n        console.error(\"Resize error:\", resizeError);\r\n      }\r\n    };\r\n    window.addEventListener(\"resize\", handleResize);\r\n\r\n    (window as any).mapEditor = {\r\n      toggleEditMode,\r\n      deleteSelected: () =>\r\n        deleteSelectedFeature(\r\n          selectInteractionRef.current,\r\n          vectorSourceRef.current,\r\n          pointsSourceRef.current,\r\n          setShowCustomizePanel,\r\n          setSelectedFeature\r\n        ),\r\n      exportGeoJSON: (filename = \"map_export.geojson\") => {\r\n        exportGeoJSON(vectorSource, filename);\r\n      },\r\n    };\r\n\r\n    return () => {\r\n      clearInterval(uiUpdateInterval);\r\n      if (locationWatchIdRef.current) {\r\n        navigator.geolocation.clearWatch(locationWatchIdRef.current);\r\n        locationWatchIdRef.current = null;\r\n      }\r\n      if (locationNodeIntervalRef.current) {\r\n        clearInterval(locationNodeIntervalRef.current);\r\n        locationNodeIntervalRef.current = null;\r\n      }\r\n      window.removeEventListener(\"resize\", handleResize);\r\n      delete (window as any).mapEditor;\r\n      map.setTarget(undefined);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const cleanup = initializeMap();\r\n    return () => {\r\n      if (cleanup) cleanup();\r\n    };\r\n  }, []);\r\n\r\n  // Memoize UI components to reduce re-renders\r\n  const OutsideSchoolAlert = useMemo(() => {\r\n    if (isOutsideSchool && locationTrackingEnabled) {\r\n      return (\r\n        <div className=\"absolute top-20 left-0 right-0 mx-auto w-64 bg-yellow-500 text-white p-3 rounded-lg z-20 text-center shadow-lg\">\r\n          <strong>Notice:</strong> You appear to be outside the campus\r\n          boundaries. Navigation will use the main gate as your starting point.\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [isOutsideSchool, locationTrackingEnabled]);\r\n\r\n  // Memoize location error alert\r\n  const LocationErrorAlert = useMemo(() => {\r\n    if (locationError) {\r\n      return (\r\n        <div className=\"absolute top-20 left-0 right-0 mx-auto w-80 bg-red-500 text-white p-3 rounded-lg z-20 text-center shadow-lg\">\r\n          {locationError}\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [locationError]);\r\n\r\n  // Memoize location permission request button\r\n  const LocationPermissionButton = useMemo(() => {\r\n    if (!locationPermissionRequested) {\r\n      return (\r\n        <div className=\"absolute top-20 left-4 z-40 bg-white bg-opacity-90 p-4 rounded-lg shadow-lg\">\r\n          <h3 className=\"font-bold mb-2\">Location Access</h3>\r\n          <p className=\"text-sm mb-3\">\r\n            Grant location access to enable real-time navigation on campus.\r\n          </p>\r\n          <button\r\n            className=\"bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 w-full\"\r\n            onClick={requestLocationPermission}\r\n          >\r\n            Enable Location\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [locationPermissionRequested, requestLocationPermission]);\r\n\r\n  // Memoize edit controls\r\n  const EditControlsComponent = useMemo(\r\n    () => (\r\n      <EditControls\r\n        isEditMode={isEditMode}\r\n        toggleEditMode={toggleEditMode}\r\n        drawType={drawType}\r\n        handleDrawInteractionToggle={handleDrawInteractionToggle}\r\n        handleDeleteSelected={handleDeleteSelected}\r\n        handleExportMap={handleExportMap}\r\n      />\r\n    ),\r\n    [\r\n      isEditMode,\r\n      toggleEditMode,\r\n      drawType,\r\n      handleDrawInteractionToggle,\r\n      handleDeleteSelected,\r\n      handleExportMap,\r\n    ]\r\n  );\r\n\r\n  // Memoize customization panel\r\n  const CustomizationPanelComponent = useMemo(() => {\r\n    if (showCustomizePanel) {\r\n      return (\r\n        <CustomizationPanel\r\n          featureProperties={featureProperties}\r\n          updateFeatureProperty={updateFeatureProperty}\r\n          markerSizeOptions={markerSizeOptions}\r\n          onClose={handleCloseCustomizePanel}\r\n        />\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    showCustomizePanel,\r\n    featureProperties,\r\n    updateFeatureProperty,\r\n    markerSizeOptions,\r\n    handleCloseCustomizePanel,\r\n  ]);\r\n\r\n  // Memoize navigation status bar\r\n  const NavigationStatusBar = useMemo(\r\n    () => (\r\n      <div className=\"absolute top-4 right-4 z-30 bg-white bg-opacity-90 p-2 rounded-lg shadow-lg\">\r\n        <div className=\"text-sm font-medium\">\r\n          {currentLocation ? (\r\n            <span className=\"text-green-600\">\r\n              ● Current location: {currentLocation.name}\r\n            </span>\r\n          ) : locationPermissionRequested && defaultStartLocation ? (\r\n            <span className=\"text-yellow-600\">\r\n              ● Using default: {defaultStartLocation.name}\r\n            </span>\r\n          ) : (\r\n            <span className=\"text-gray-600\">● Location: Not available</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    ),\r\n    [currentLocation, locationPermissionRequested, defaultStartLocation]\r\n  );\r\n\r\n  // Memoize destination selector button\r\n  const DestinationSelectorButton = useMemo(\r\n    () => (\r\n      <div className=\"absolute bottom-4 right-4 z-30\">\r\n        <button\r\n          className=\"bg-blue-500 text-white p-3 rounded-full shadow-lg hover:bg-blue-600 focus:outline-none\"\r\n          onClick={handleShowDestinationSelector}\r\n        >\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            width=\"24\"\r\n            height=\"24\"\r\n            viewBox=\"0 0 24 24\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            strokeWidth=\"2\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n          >\r\n            <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\r\n            <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    ),\r\n    [handleShowDestinationSelector]\r\n  );\r\n\r\n  // Memoize destination selector\r\n  const DestinationSelectorComponent = useMemo(() => {\r\n    if (showDestinationSelector) {\r\n      return (\r\n        <div className=\"absolute top-4 left-4 z-40\">\r\n          <DestinationSelector\r\n            destinations={destinations}\r\n            onSelect={handleDestinationSelect}\r\n            onClose={handleCloseDestinationSelector}\r\n            categories={[\r\n              \"Gates\",\r\n              \"Main Buildings\",\r\n              \"Maritime\",\r\n              \"Business\",\r\n              \"Facilities\",\r\n              \"Sports Facilities\",\r\n            ]}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    showDestinationSelector,\r\n    destinations,\r\n    handleDestinationSelect,\r\n    handleCloseDestinationSelector,\r\n  ]);\r\n\r\n\r\n  // Memoize route overlay\r\n  const RouteOverlayComponent = useMemo(() => {\r\n    if (showRouteOverlay && selectedDestination) {\r\n      return (\r\n        <RouteOverlay\r\n          startNode={currentLocation || defaultStartLocation}\r\n          endNode={selectedDestination}\r\n          routeInfo={routeInfo}\r\n          onCancel={clearRoute}\r\n          onGenerateQR={handleGenerateQR}\r\n        />\r\n      );\r\n    }\r\n    return null;\r\n  }, [\r\n    showRouteOverlay,\r\n    selectedDestination,\r\n    currentLocation,\r\n    defaultStartLocation,\r\n    routeInfo,\r\n    clearRoute,\r\n    handleGenerateQR,\r\n  ]);\r\n\r\n\r\n  const renderMobileUI = () => {\r\n    if (!mobileMode) return null;\r\n\r\n    return (\r\n      <>\r\n        {/* Mobile Header */}\r\n        <div className=\"fixed top-0 left-0 right-0 bg-white p-3 shadow-md z-40\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <button\r\n              className=\"w-10 h-10 flex items-center justify-center rounded-full bg-gray-100\"\r\n              onClick={() => router.back()}\r\n            >\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                width=\"24\"\r\n                height=\"24\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                strokeWidth=\"2\"\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n              >\r\n                <path d=\"m15 18-6-6 6-6\"></path>\r\n              </svg>\r\n            </button>\r\n\r\n            <h1 className=\"text-lg font-bold text-gray-900\">\r\n              {selectedDestination\r\n                ? `Navigate to ${selectedDestination.name}`\r\n                : \"Campus Map\"}\r\n            </h1>\r\n\r\n            <button\r\n              className=\"w-10 h-10 flex items-center justify-center rounded-full bg-blue-500 text-white\"\r\n              onClick={() => {\r\n                if (mapInstanceRef.current && currentLocation) {\r\n                  const coords = fromLonLat(currentLocation.coordinates);\r\n                  mapInstanceRef.current.getView().setCenter(coords);\r\n                  mapInstanceRef.current.getView().setZoom(18);\r\n                } else {\r\n                  initLocationTracking();\r\n                }\r\n              }}\r\n            >\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                width=\"20\"\r\n                height=\"20\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                strokeWidth=\"2\"\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n              >\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n                <circle cx=\"12\" cy=\"12\" r=\"1\"></circle>\r\n                <path d=\"M12 2v4\"></path>\r\n                <path d=\"M12 18v4\"></path>\r\n                <path d=\"M4.93 4.93l2.83 2.83\"></path>\r\n                <path d=\"M16.24 16.24l2.83 2.83\"></path>\r\n                <path d=\"M2 12h4\"></path>\r\n                <path d=\"M18 12h4\"></path>\r\n                <path d=\"M4.93 19.07l2.83-2.83\"></path>\r\n                <path d=\"M16.24 7.76l2.83-2.83\"></path>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Floating Locate Button */}\r\n        <button\r\n          className=\"fixed right-4 bottom-24 z-40 w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center border border-gray-200\"\r\n          onClick={() => {\r\n            if (mapInstanceRef.current && currentLocation) {\r\n              const coords = fromLonLat(currentLocation.coordinates);\r\n              mapInstanceRef.current.getView().setCenter(coords);\r\n              mapInstanceRef.current.getView().setZoom(18);\r\n            } else {\r\n              initLocationTracking();\r\n            }\r\n          }}\r\n        >\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            width=\"20\"\r\n            height=\"20\"\r\n            viewBox=\"0 0 24 24\"\r\n            fill=\"none\"\r\n            stroke=\"#4b5563\"\r\n            strokeWidth=\"2\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n          >\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n            <circle cx=\"12\" cy=\"12\" r=\"1\"></circle>\r\n            <path d=\"M12 2v4\"></path>\r\n            <path d=\"M12 18v4\"></path>\r\n            <path d=\"M4.93 4.93l2.83 2.83\"></path>\r\n            <path d=\"M16.24 16.24l2.83 2.83\"></path>\r\n            <path d=\"M2 12h4\"></path>\r\n            <path d=\"M18 12h4\"></path>\r\n            <path d=\"M4.93 19.07l2.83-2.83\"></path>\r\n            <path d=\"M16.24 7.76l2.83-2.83\"></path>\r\n          </svg>\r\n        </button>\r\n\r\n        {/* Enhanced Mobile Route Panel */}\r\n        {showRouteOverlay && selectedDestination && (\r\n          <EnhancedMobileRoutePanel\r\n            destination={selectedDestination}\r\n            currentLocation={currentLocation}\r\n            routeInfo={routeInfo}\r\n            routeProgress={routeProgress}\r\n            onClose={clearRoute}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full h-screen\">\r\n      <div\r\n        ref={mapRef}\r\n        className=\"w-full h-full absolute top-0 left-0\"\r\n        style={{\r\n          boxShadow: mobileMode ? \"none\" : \"0 4px 20px rgba(0,0,0,0.15)\",\r\n          borderRadius: mobileMode ? \"0\" : \"12px\",\r\n        }}\r\n      />\r\n\r\n      {/* Conditionally show/hide UI elements based on mobileMode */}\r\n      {OutsideSchoolAlert && !mobileMode && OutsideSchoolAlert}\r\n      {LocationErrorAlert}\r\n      {!mobileMode && LocationPermissionButton}\r\n      {!mobileMode && EditControlsComponent}\r\n      {!mobileMode && CustomizationPanelComponent}\r\n      {!mobileMode && NavigationStatusBar}\r\n      {!mobileMode && DestinationSelectorButton}\r\n      {showDestinationSelector && !mobileMode && DestinationSelectorComponent}\r\n\r\n      {/* Render mobile UI */}\r\n      {mobileMode && renderMobileUI()}\r\n\r\n      {RouteOverlayComponent}\r\n      {showQRModal && selectedDestination && (\r\n        <KioskQRModal\r\n          qrCodeUrl={qrCodeUrl}\r\n          destination={selectedDestination}\r\n          routeInfo={routeInfo}\r\n          onClose={closeQRModal}\r\n          autoCloseTime={60} // Seconds before auto-close\r\n        />\r\n      )}\r\n\r\n      {/* Add loading and error states */}\r\n      {isGenerating && (\r\n        <div className=\"absolute inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50\">\r\n          <div className=\"bg-white p-6 rounded-lg shadow-xl flex flex-col items-center\">\r\n            <div className=\"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4\"></div>\r\n            <p className=\"text-gray-800 font-medium\">Generating QR Code...</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {error && (\r\n        <div className=\"absolute top-20 left-0 right-0 mx-auto w-80 bg-red-500 text-white p-3 rounded-lg z-30 text-center shadow-lg\">\r\n          {error}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst MemoizedCampusMap = React.memo(CampusMap);\r\n\r\nexport default dynamic(() => Promise.resolve(MemoizedCampusMap), {\r\n  ssr: false,\r\n});\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6259, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}